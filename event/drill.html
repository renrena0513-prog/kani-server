<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã»ã‚Šã»ã‚Šãƒ‰ãƒªãƒ« | ã‹ã«ã‚µãƒ¼ãƒãƒ¼</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=M+PLUS+Rounded+1c:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Bootswatch Lux -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        :root {
            --primary-drill: #8b4513;
            --secondary-drill: #d2b48c;
            --font-title: 'Noto Serif JP', serif;
            --font-body: 'M PLUS Rounded 1c', sans-serif;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            min-height: 100vh;
            color: #eee;
        }

        .page-header {
            font-family: var(--font-title);
            color: #fff;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            margin-bottom: 2rem;
        }

        .drill-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .drill-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            display: block;
        }

        .coming-soon {
            font-size: 1.5rem;
            color: #ffc107;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯ä¸­ã®è¡¨ç¤º */
        #admin-check-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        /* ãƒ­ã‚°ãƒ»ç¢ºç‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: left;
            font-size: 0.9rem;
            height: 100%;
        }

        .log-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 6px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .stat-card {
            background: #333;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: none;
        }

        .stat-card.primary {
            background: #f6b253;
            color: #222;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.9rem;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .reward-table {
            width: 100%;
            font-size: 0.85rem;
        }

        .reward-table td {
            padding: 4px 0;
        }

        .prob-bar-container {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            flex-grow: 1;
        }

        .prob-bar {
            height: 100%;
            border-radius: 4px;
            background: #ffc107;
        }

        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤ºã‚»ãƒƒãƒˆ */
        .user-cell {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            vertical-align: middle;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-badge {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .mutant-badge-container.mini {
            position: relative;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .mutant-badge-shine {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0) 30%,
                    rgba(255, 255, 255, 0.8) 50%,
                    rgba(255, 255, 255, 0) 70%,
                    rgba(255, 255, 255, 0) 100%);
            background-size: 200% 200%;
            animation: mutant-shine 3s infinite linear;
            border-radius: 50%;
            z-index: 1;
        }

        @keyframes mutant-shine {
            0% {
                background-position: -200% -200%;
            }

            100% {
                background-position: 200% 200%;
            }
        }
    </style>
</head>

<body>
    <div id="admin-check-overlay">
        <div class="text-center">
            <div class="spinner-border text-warning mb-3"></div>
            <div>ç®¡ç†è€…æ¨©é™ã‚’ç¢ºèªä¸­...</div>
        </div>
    </div>

    <!-- å³ä¸Šã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ç”¨ã‚¨ãƒªã‚¢ -->
    <div class="nav-dropdown"></div>

    <div class="container py-5 mt-5">
        <div class="drill-container">
            <h1 class="page-header">ğŸ—ï¸ ã»ã‚Šã»ã‚Šãƒ‰ãƒªãƒ«</h1>

            <div class="row g-4 mb-4">
                <div class="col-md-8">
                    <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ -->
                    <div class="card bg-dark bg-opacity-50 border-secondary mb-3 text-start h-100">
                        <div class="card-body">
                            <h5 class="card-title text-warning">ğŸ“œ ãƒ«ãƒ¼ãƒ«èª¬æ˜</h5>
                            <ul class="mb-0 small">
                                <li>1æ—¥æœ€å¤§ <span class="badge bg-warning text-dark">100å›</span> æ˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li>
                                <li>æ˜ã‚‹ãŸã³ã« <span class="text-info">ã‚³ã‚¤ãƒ³</span>ã€<span class="text-info">å¼•æ›åˆ¸</span>ã€<span
                                        class="text-info">é™å®šãƒãƒƒã‚¸</span> ãŒå‡ºç¾ã™ã‚‹ã‹ã‚‚ï¼ï¼Ÿ</li>
                                <li>ã‚«ã‚¦ãƒ³ãƒˆã¯æ¯æ—¥ <span class="text-warning">åˆå‰0æ™‚ (JST)</span> ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <!-- æä¾›å‰²åˆ -->
                    <div class="info-panel h-100">
                        <h6 class="text-warning mb-2">ğŸ“Š æä¾›å‰²åˆ</h6>
                        <table id="probability-table" class="reward-table">
                            <!-- JSã§ç”Ÿæˆ -->
                        </table>
                    </div>
                </div>
            </div>

            <!-- å…¨ä½“ãƒ»å€‹äººã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="stat-card primary">
                        <div class="stat-label">åˆè¨ˆã®æ·±ã•</div>
                        <div id="global-total-meters" class="stat-value">- M</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥ã®æ®‹ã‚Š</div>
                        <div id="daily-remaining" class="stat-value">-</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <div class="stat-label">è‡ªåˆ†ãŒæ˜ã£ãŸæ·±ã•</div>
                        <div id="total-taps" class="stat-value">- M</div>
                    </div>
                </div>
            </div>

            <!-- æ˜å‰Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="dig-area my-5">
                <div id="drill-visual" class="drill-visual">
                    <span class="drill-emoji">ğŸ—ï¸</span>
                    <div id="dirt-effect" class="dirt-effect"></div>
                </div>

                <button id="dig-button" class="btn btn-warning btn-lg rounded-pill px-5 py-3 fw-bold shadow-lg mt-4"
                    onclick="handleDig()">
                    æ˜ã‚‹ï¼
                </button>
            </div>

            <div id="result-message" class="mt-3 h5 fw-bold" style="min-height: 1.5rem;"></div>

            <!-- æœ€è¿‘ã®ãƒ­ã‚° -->
            <div class="mt-5 text-start">
                <h6 class="text-white-50 mb-3">ğŸ“ æœ€è¿‘ã®æ˜ã‚Šå‡ºã—ãƒ­ã‚°</h6>
                <div id="recent-logs" class="info-panel"
                    style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                    <p class="text-center text-muted py-5">ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å ±é…¬ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="reward-modal" class="modal fade" tabindex="-1" aria-hidden="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border-warning">
                <div class="modal-body text-center py-5">
                    <h2 class="text-warning mb-4">âœ¨ ãŠå®ç™ºè¦‹ï¼ âœ¨</h2>
                    <div id="reward-content" class="h3 mb-4"></div>
                    <button type="button" class="btn btn-warning rounded-pill px-4"
                        data-bs-dismiss="modal">ã‚„ã£ãŸãƒ¼ï¼</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .drill-visual {
            font-size: 6rem;
            position: relative;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
        }

        .drill-emoji {
            display: inline-block;
            transition: transform 0.1s;
        }

        /* æ˜å‰Šä¸­ã®æŒ¯å‹•ã¨ä¸‹é™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .digging .drill-emoji {
            animation: vibrate 0.1s infinite, descend 1s ease-in-out;
        }

        @keyframes vibrate {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        @keyframes descend {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(20px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .dirt-effect {
            position: absolute;
            bottom: 0;
            width: 100px;
            height: 20px;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: #8b4513;
            border-radius: 50%;
            opacity: 0;
            animation: particle-fly 0.5s ease-out forwards;
        }

        @keyframes particle-fly {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }

            100% {
                transform: translate(var(--tx), var(--ty));
                opacity: 0;
            }
        }
    </style>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/navigation.js"></script>
    <script>
        let currentUserId = null;
        let isDigging = false;

        // ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯
        async function checkAdmin() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            const overlay = document.getElementById('admin-check-overlay');

            if (!user) {
                window.location.href = '../index.html';
                return;
            }

            currentUserId = user.user_metadata.provider_id;

            if (!ADMIN_DISCORD_IDS.includes(currentUserId)) {
                alert('ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                window.location.href = '../index.html';
                return;
            }

            // ç®¡ç†è€…ãªã‚‰è¡¨ç¤º
            overlay.style.display = 'none';
            initAccordionNav('../');
            loadStats();
        }

        // çµ±è¨ˆèª­ã¿è¾¼ã¿
        async function loadStats() {
            try {
                // è‡ªåˆ†ã¨å…¨ä½“ã®çµ±è¨ˆã‚’ä¸¦åˆ—å–å¾—
                const [userRes, globalRes, rewardsRes, logsRes, mutantRes] = await Promise.all([
                    supabaseClient.from('event_drill_user_stats').select('*').eq('user_id', currentUserId).maybeSingle(),
                    supabaseClient.from('event_drill_user_stats').select('total_taps'),
                    supabaseClient.from('event_drill_rewards').select('*').eq('is_active', true).order('probability_weight', { ascending: false }),
                    supabaseClient.from('event_drill_logs')
                        .select(`
                            created_at, reward_name, depth, 
                            profiles!user_id(
                                discord_user_id, account_name, avatar_url, 
                                equipped_badge_id, equipped_badge_id_right,
                                badges!equipped_badge_id(image_url, name),
                                badges_right:badges!equipped_badge_id_right(image_url, name)
                            )
                        `)
                        .order('created_at', { ascending: false })
                        .limit(20),
                    supabaseClient.from('user_badges_new').select('user_id, badge_id, is_mutant').eq('is_mutant', true)
                ]);

                // ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ³ãƒˆæƒ…å ±ã®ãƒãƒƒãƒ—ä½œæˆ
                const mutantMap = {};
                (mutantRes.data || []).forEach(m => {
                    mutantMap[`${m.user_id}_${m.badge_id}`] = true;
                });
                window.drillMutantMap = mutantMap;

                if (userRes.error) throw userRes.error;
                if (globalRes.error) throw globalRes.error;
                if (rewardsRes.error) throw rewardsRes.error;

                // è‡ªåˆ†ã®çµ±è¨ˆ
                if (userRes.data) {
                    const lastTap = new Date(userRes.data.last_tap_at);
                    const now = new Date();
                    const midnightJST = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Tokyo" }));
                    midnightJST.setHours(0, 0, 0, 0);

                    const dailyTaps = (lastTap < midnightJST) ? 0 : userRes.data.daily_taps;

                    document.getElementById('daily-remaining').textContent = (100 - dailyTaps);
                    document.getElementById('total-taps').textContent = userRes.data.total_taps.toLocaleString() + ' M';
                } else {
                    document.getElementById('daily-remaining').textContent = '100';
                    document.getElementById('total-taps').textContent = '0 M';
                }

                // å…¨ä½“ã®çµ±è¨ˆ
                const globalTotal = (globalRes.data || []).reduce((acc, curr) => acc + (parseInt(curr.total_taps) || 0), 0);
                document.getElementById('global-total-meters').textContent = globalTotal.toLocaleString() + ' M';

                // æä¾›å‰²åˆ
                renderProbabilities(rewardsRes.data || []);

                // ãƒ­ã‚°
                renderLogs(logsRes.data || []);

            } catch (err) {
                console.error('Stats load error:', err);
            }
        }

        // æä¾›å‰²åˆã®æç”»
        function renderProbabilities(rewards) {
            const table = document.getElementById('probability-table');
            const totalWeight = rewards.reduce((acc, r) => acc + r.probability_weight, 0);

            table.innerHTML = rewards.map(r => {
                const prob = ((r.probability_weight / totalWeight) * 100).toFixed(1);
                return `
                    <tr>
                        <td style="width: 35%">${r.reward_name}</td>
                        <td style="width: 20%; text-align: right; padding-right: 15px;">${prob}%</td>
                        <td>
                            <div class="prob-bar-container">
                                <div class="prob-bar" style="width: ${prob}%"></div>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ãƒ­ã‚°ã®æç”»
        function renderLogs(logs) {
            const container = document.getElementById('recent-logs');
            if (!logs || logs.length === 0) {
                container.innerHTML = '<p class="text-center text-muted py-5">ã¾ã æ˜ã‚Šå‡ºã—ç‰©ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            container.innerHTML = logs.map(log => {
                const profile = log.profiles;
                const name = profile?.account_name || 'ä¸æ˜ãªãƒ¦ãƒ¼ã‚¶ãƒ¼';
                const avatar = profile?.avatar_url || 'https://via.placeholder.com/32';
                const reward = log.reward_name || 'ã‚¢ã‚¤ãƒ†ãƒ ';
                const depth = log.depth || '?';
                const time = new Date(log.created_at).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });

                // ãƒãƒƒã‚¸è¡¨ç¤ºã®ç”Ÿæˆ
                const renderBadge = (badge, id, userId) => {
                    if (!badge) return '';
                    const isMutant = window.drillMutantMap[`${userId}_${id}`];
                    return `
                        <div class="mutant-badge-container mini ${isMutant ? 'active' : ''}">
                            <img src="${badge.image_url}" class="user-badge" title="${badge.name}">
                            <div class="mutant-badge-shine" style="display: ${isMutant ? 'block' : 'none'};"></div>
                        </div>`;
                };

                const badgeLeft = renderBadge(profile?.badges, profile?.equipped_badge_id, profile?.discord_user_id);
                const badgeRight = renderBadge(profile?.badges_right, profile?.equipped_badge_id_right, profile?.discord_user_id);

                return `
                    <div class="log-item d-flex align-items-center gap-2 py-2 border-bottom border-white border-opacity-10">
                        <span class="text-white-50 small" style="min-width: 45px;">${time}</span>
                        <div class="user-cell">
                            <img src="${avatar}" class="user-avatar" onerror="this.src='https://via.placeholder.com/32'">
                            ${badgeLeft}
                            <span class="fw-bold text-warning">${name}</span>
                            ${badgeRight}
                        </div>
                        <div class="ms-1">
                            <span>ãŒ</span>
                            <span class="text-info">${depth}M</span>
                            <span>ã§</span>
                            <span class="fw-bold">${reward}</span>
                            <span>ã‚’æ˜ã‚Šå½“ã¦ãŸï¼</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ˜ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        async function handleDig() {
            if (isDigging) return;
            isDigging = true;

            const btn = document.getElementById('dig-button');
            const visual = document.getElementById('drill-visual');
            const resultMsg = document.getElementById('result-message');

            btn.disabled = true;
            visual.classList.add('digging');
            resultMsg.textContent = 'æ˜å‰Šä¸­...';
            createParticles();

            try {
                const { data, error } = await supabaseClient.rpc('process_drill_tap', {
                    target_user_id: currentUserId
                });

                if (error) throw error;

                // æ¼”å‡ºå¾…ã¡
                await new Promise(r => setTimeout(r, 1000));

                if (data.success) {
                    // UIæ›´æ–°
                    document.getElementById('daily-remaining').textContent = (100 - data.new_daily_taps);
                    document.getElementById('total-taps').textContent = data.total_taps.toLocaleString() + ' M';

                    if (data.reward.type === 'nothing') {
                        resultMsg.innerHTML = '<span class="text-white-50">ä½•ã‚‚è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸ...</span>';
                    } else {
                        showReward(data.reward);
                        resultMsg.innerHTML = `<span class="text-warning">ã€Œ${data.reward.name}ã€ã‚’ã‚²ãƒƒãƒˆï¼</span>`;
                        // ãƒ­ã‚°ã‚’å³å–å¾—
                        setTimeout(loadStats, 500);
                    }

                    // å…¨ä½“ã®çµ±è¨ˆã‚’æˆ»ã‚Šå€¤ã§æ›´æ–° (ã‚µãƒ¼ãƒãƒ¼è² è·å‰Šæ¸›)
                    if (data.global_total_meters !== undefined) {
                        document.getElementById('global-total-meters').textContent = data.global_total_meters.toLocaleString() + ' M';
                    } else {
                        loadGlobalStatsOnly();
                    }

                } else {
                    if (data.error === 'DAILY_LIMIT_REACHED') {
                        resultMsg.innerHTML = '<span class="text-danger">ä»Šæ—¥ã®é™ç•Œï¼ˆ100å›ï¼‰ã«é”ã—ã¾ã—ãŸï¼</span>';
                    } else {
                        resultMsg.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
                    }
                }
            } catch (err) {
                console.error('Dig error:', err);
                resultMsg.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
            } finally {
                visual.classList.remove('digging');
                btn.disabled = false;
                isDigging = false;
            }
        }

        // å…¨ä½“ã®çµ±è¨ˆã®ã¿æ›´æ–°ï¼ˆè»½é‡ï¼‰
        async function loadGlobalStatsOnly() {
            try {
                const { data } = await supabaseClient.from('event_drill_user_stats').select('total_taps');
                const globalTotal = (data || []).reduce((acc, curr) => acc + (parseInt(curr.total_taps) || 0), 0);
                document.getElementById('global-total-meters').textContent = globalTotal.toLocaleString() + ' M';
            } catch (e) { }
        }

        // å ±é…¬è¡¨ç¤º
        function showReward(reward) {
            const content = document.getElementById('reward-content');
            let rewardHtml = '';

            if (reward.type === 'coin') {
                rewardHtml = `<div class="display-4">ğŸ’°</div><div>${reward.amount} ã‚³ã‚¤ãƒ³</div>`;
            } else if (reward.type === 'gacha_ticket') {
                rewardHtml = `<div class="display-4">ğŸ«</div><div>${reward.name}</div>`;
            } else if (reward.type === 'exchange_ticket') {
                rewardHtml = `<div class="display-4">ğŸ·ï¸</div><div>${reward.name}</div>`;
            } else if (reward.type === 'badge') {
                rewardHtml = `<div class="display-4">ğŸ“›</div><div>${reward.name} (é™å®šãƒãƒƒã‚¸)</div>`;
            }

            content.innerHTML = rewardHtml;
            const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('reward-modal'));
            modal.show();
        }

        // åœŸç…™ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createParticles() {
            const container = document.getElementById('dirt-effect');
            for (let i = 0; i < 15; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 8 + 4;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.left = '50%';

                // é£›ã³æ•£ã‚‹æ–¹å‘ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«
                const tx = (Math.random() - 0.5) * 200;
                const ty = -Math.random() * 100 - 50;
                p.style.setProperty('--tx', tx + 'px');
                p.style.setProperty('--ty', ty + 'px');

                container.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        document.addEventListener('DOMContentLoaded', checkAdmin);
    </script>
</body>

</html>