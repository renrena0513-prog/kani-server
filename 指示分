# 仕様調整：バースト→FS遷移を「報酬0で確定（cashout相当）」と同じ扱いにして固着を防ぐ

背景：
- “報酬確定(cashout)” を押してFSへ入る場合は正常に動く。
- しかし “バーストからFSへ入る” 場合、FS中に特定リールで固着して再開になることがある。
- つまり、バースト→FS遷移時にフロントが「まだ通常モード」と誤解している/状態がねじれている可能性が高い。

狙い：
- バースト→FS遷移を、内部的に「報酬0で確定したのと同じ遷移（cashout相当）」として統一し、
  フロントが確実に“FS遷移”として扱えるようにする。

やってほしいこと（SQL + フロント）：

## 1) SQL（slot_spin_reel）
通常モード中にバーストが発生し、かつ「JP条件によりFSへ遷移する」ケースで、
単に free_spin_active=true を立てるだけでなく、cashout相当の“遷移結果”をレスポンスで明示してほしい。

- バースト→FS遷移した場合、slot_spin_reel の返却JSONに
  - outcome: "free_spin"（slot_cashout の free_spin outcome と同様の意味）
  - payout: []（報酬0確定）
  - entered_free_spin: true（任意：フロント用の明示フラグ）
  を追加する（フィールド名は多少変更可、ただし意図は同じ）。
- セッション側は必ず
  - free_spin_active=true
  - free_spin_round=1
  - current_reel=1
  - free_spins_remaining>=1（JPヒット数など）
  になっていることを保証する。
- reels_state は7リール固定のままでOK（不足分をBURST埋めする方針は維持）。
- DB書き込み回数は増やさない（今と同程度の UPDATE 回数に留める）。

## 2) フロント（event/slot.html）
spinReel() の成功ハンドリングで、
- data.outcome==="free_spin" または data.entered_free_spin===true のときは
  “cashoutでFSへ入った時と同じ状態遷移” を必ず実行する。

具体的には（実装は任せるが意図はこれ）：
- fsLoopActive を止める/STOP系の残留（pendingStopReels, reelState, isProcessing）を正規化
- awaitingFreeSpinStart=true にして「フリースピン開始」ボタンを押せる状態へ
- updateUI() を呼んで UI をFS開始待機へ確実に寄せる
（※ cashout経由で動くのと同じ結果になることが目的）

受け入れ条件：
- バースト→FS遷移後も、FSが同じリールで固着せず正常に進行する
- “報酬確定(cashout)” を押した時と同じようにFS開始ができる
- DB負荷（書き込み回数）が増えない