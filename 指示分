# Codex依頼：bust判定の根本修正（通常でbustした時は埋める / FS中は絶対誤爆しない）

対象：event/slot.html（spinReel周り）

背景：
- いまの修正は `!currentSession.free_spin_active && resultReel.is_bust` で bust 埋めを判断しているが、
  RPC成功後は `currentSession` が server返却で更新されるため、
  「通常でbust→そのスピンでFSに突入」ケースでは free_spin_active=true になり、bust埋めが発火しない可能性がある。
- bust埋めの実行可否は「このスピン要求が通常だったか（RPC前の状態）」で判定すべき。

やること：
1) spinReel() の RPC呼び出し前に取得している（または追加する）フラグを使用：
   - `const prevFreeSpinActive = !!currentSession.free_spin_active;`
2) bust埋めの条件を次に差し替える（最小差分）：
   - `resultReel = data.result || ...`
   - **if (!prevFreeSpinActive && resultReel?.is_bust) { applyBurstToRemainingReels(); }**
   - else { updateReelButtons(); }
   ※ FS中（prevFreeSpinActive=true）では絶対に applyBurstToRemainingReels を呼ばない
   ※ 通常でbustした場合は、そのスピンでFSに入ったとしても埋めを実行する（6,7をBURST表示にするため）

3) 可能なら追加で（バグ潰しのため推奨、差分小さめで）：
   applyBurstToRemainingReels() 内の alreadyStopped 判定が mode/round無視で誤判定しうるので、
   「通常モードのbust埋め」では `is_free_spin=false` のデータだけを stopped 判定に使うように絞る。

受け入れ条件：
- FS中に bust判定が誤爆して fsLoopActive が落ちない（＝途中で勝手に再開にならない）
- 通常でbustが出たら残りリール（例：6,7）も必ずBURST表示で埋まる（＝未停止/空が残らない）
- 通常でbust→そのままFS突入するケースでも、bust埋めが発火する（旧条件だと潰れていたはず）