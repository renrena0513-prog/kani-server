<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚®ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰ - ã‹ã«é¯–</title>
    <link rel="icon" type="image/png" href="../images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        :root {
            --gift-purple: #6a5acd;
            --gift-pink: #ff7eb3;
            --gift-gold: #d4a574;
            --font-title: 'Kosugi Maru', sans-serif;
        }

        body {
            background: radial-gradient(circle at top, #fff3c4 0%, #ffd6e7 35%, #b8d7ff 100%);
            min-height: 100vh;
        }

        .page-header {
            color: #fff;
            font-family: var(--font-title);
            text-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
            margin-bottom: 30px;
        }

        .gift-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
            max-width: 720px;
            margin: 0 auto;
        }

        .gift-card .form-control {
            border-radius: 999px;
            border: 2px solid #f1c7d8;
            padding: 12px 18px;
            font-size: 1.05rem;
        }

        .gift-card .btn-gift {
            background: linear-gradient(135deg, var(--gift-pink) 0%, var(--gift-purple) 100%);
            color: #fff;
            border: none;
            padding: 12px 32px;
            font-weight: bold;
            border-radius: 999px;
            box-shadow: 0 6px 18px rgba(106, 90, 205, 0.35);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .gift-card .btn-gift:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 22px rgba(106, 90, 205, 0.45);
        }

        .gift-section-title {
            font-family: var(--font-title);
            color: #5a4a7a;
        }

        .history-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.12);
        }

        .history-table th {
            color: #6c5b7b;
            font-weight: 700;
        }

        .history-empty {
            color: #8b7a95;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.15);
        }

        .admin-panel .btn {
            border-radius: 999px;
        }

        .admin-table th {
            font-size: 0.9rem;
            color: #6b6b6b;
        }

        .admin-table td {
            vertical-align: middle;
        }

        @media (max-width: 768px) {
            .gift-card {
                padding: 24px;
            }

            .history-card {
                padding: 18px;
            }
        }
    </style>
</head>

<body>
    <div class="nav-dropdown"></div>

    <div class="container py-5 mt-5">
        <h1 class="page-header text-center">ğŸ ã‚®ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰</h1>

        <div class="gift-card mb-5">
            <div class="text-center mb-4">
                <h4 class="gift-section-title">ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦å—ã‘å–ã‚‹</h4>
                <div class="small text-muted">ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠãƒ»å¤§å°æ–‡å­—ã¯è‡ªå‹•ã§åˆ¤å®šã—ã¾ã™</div>
            </div>
            <div class="input-group">
                <input type="text" id="giftcode-input" class="form-control" placeholder="ã‚®ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
                <button class="btn btn-gift" id="giftcode-submit" type="button">é€ä¿¡</button>
            </div>
        </div>

        <div class="history-card mb-5">
            <h5 class="gift-section-title mb-3">éå»å—ã‘å–ã‚Šä¸€è¦§</h5>
            <div class="table-responsive">
                <table class="table table-sm align-middle history-table">
                    <thead>
                        <tr>
                            <th>ã‚³ãƒ¼ãƒ‰</th>
                            <th>å—ã‘å–ã‚Šæ—¥æ™‚</th>
                            <th>å—ã‘å–ã‚Šå†…å®¹</th>
                        </tr>
                    </thead>
                    <tbody id="gift-history-body">
                        <tr>
                            <td colspan="3" class="text-center history-empty">èª­ã¿è¾¼ã¿ä¸­...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="gift-admin-section" class="admin-panel mb-5" style="display: none;">
            <h5 class="gift-section-title mb-3">ç®¡ç†è€…ã‚»ã‚¯ã‚·ãƒ§ãƒ³</h5>
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-outline-primary" id="gift-admin-add-btn">ã‚®ãƒ•ãƒˆè¿½åŠ </button>
                <button class="btn btn-outline-secondary" id="gift-admin-list-btn">ã‚³ãƒ¼ãƒ‰ä¸€è¦§</button>
            </div>
            <div class="small text-muted mt-3">â€» ç®¡ç†è€…ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
    </div>

    <!-- çµæœãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒƒã‚¸è³¼å…¥æ™‚ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã«åˆã‚ã›ãŸãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ -->
    <div class="modal fade" id="giftResultModal" tabindex="-1" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg border-0" style="border-radius: 20px;">
                <div class="modal-body p-4 text-center">
                    <div id="giftResultMessage" class="fw-bold"></div>
                    <div class="mt-4 d-flex justify-content-center">
                        <button type="button" class="btn btn-secondary rounded-pill px-4"
                            data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†è€…: ã‚®ãƒ•ãƒˆè¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="giftAddModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">ğŸ ã‚®ãƒ•ãƒˆè¿½åŠ </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-2">
                    <form id="gift-add-form">
                        <div class="mb-3">
                            <label class="form-label">ã‚³ãƒ¼ãƒ‰å</label>
                            <input type="text" id="gift-add-code" class="form-control" maxlength="80" required>
                        </div>
                        <div class="row g-2">
                            <div class="col-4">
                                <label class="form-label">ã‚³ã‚¤ãƒ³</label>
                                <input type="number" id="gift-add-coin" class="form-control" min="0" value="0" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">ç¥ˆé¡˜ç¬¦</label>
                                <input type="number" id="gift-add-kiganfu" class="form-control" min="0" value="0"
                                    required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">æº€é¡˜ç¬¦</label>
                                <input type="number" id="gift-add-manganfu" class="form-control" min="0" value="0"
                                    required>
                            </div>
                        </div>
                        <div class="form-check form-switch mt-3">
                            <input class="form-check-input" type="checkbox" id="gift-add-active" checked>
                            <label class="form-check-label" for="gift-add-active">æœ‰åŠ¹</label>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">å›æ•° <span class="text-muted small">(ç©ºæ¬„=ç„¡åˆ¶é™)</span></label>
                            <input type="number" id="gift-add-remaining" class="form-control" min="1" placeholder="âˆ">
                        </div>
                        <div class="text-end mt-4">
                            <button type="submit" class="btn btn-primary">è¿½åŠ ã™ã‚‹</button>
                        </div>
                    </form>
                    <div id="gift-add-message" class="small mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†è€…: ã‚³ãƒ¼ãƒ‰ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="giftListModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">ğŸ“‹ ã‚®ãƒ•ãƒˆã‚³ãƒ¼ãƒ‰ä¸€è¦§</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-2">
                    <div class="table-responsive">
                        <table class="table table-sm align-middle admin-table">
                            <thead>
                                <tr>
                                    <th>code_raw</th>
                                    <th>code_norm</th>
                                    <th>ã‚³ã‚¤ãƒ³</th>
                                    <th>ç¥ˆé¡˜ç¬¦</th>
                                    <th>æº€é¡˜ç¬¦</th>
                                    <th>æ®‹å›æ•°</th>
                                    <th>æœ‰åŠ¹</th>
                                    <th>ä½œæˆæ—¥</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="gift-admin-table-body">
                                <tr>
                                    <td colspan="9" class="text-center text-muted">èª­ã¿è¾¼ã¿ä¸­...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/auth-guard.js"></script>
    <script src="../js/navigation.js"></script>
    <script src="../js/giftcode-utils.js"></script>
    <script src="../js/giftcode.js"></script>
</body>

</html>