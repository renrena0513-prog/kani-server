<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="„Åã„Å´„Çµ„Éº„Éê„Éº - ÁÆ°ÁêÜÁîªÈù¢">
    <title>ÁÆ°ÁêÜÁîªÈù¢ | „Åã„Å´„Çµ„Éº„Éê„Éº„Ç§„Éô„É≥„Éà</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Bootswatch Lux (Bootstrap 5.3.3) -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-gray: #3a3a4a;
            --deep-gray: #252530;
            --cream: #faf5e8;
            --gold: #d4a853;
            --font-title: 'Noto Serif JP', serif;
            --font-body: 'M PLUS Rounded 1c', sans-serif;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(180deg, #3a3a4a 0%, #2d2d3a 50%, #252530 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .page-header {
            font-family: var(--font-title);
            color: var(--cream);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .back-button {
            font-family: var(--font-body);
            font-size: 1rem;
            padding: 10px 25px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .admin-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--gold);
        }

        .event-list-item {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .event-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .event-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            background: #f0f0f0;
        }

        .csv-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        th.sortable {
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: background 0.2s;
        }

        th.sortable:hover {
            background-color: #f0f0f0 !important;
        }

        th.sortable::after {
            content: '‚Üï';
            position: absolute;
            right: 8px;
            color: #ccc;
            font-size: 0.8em;
        }

        th.sortable.asc::after {
            content: '‚Üë';
            color: var(--gold);
        }

        th.sortable.desc::after {
            content: '‚Üì';
            color: var(--gold);
        }


        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            visibility: hidden;
        }

        /* „Éï„Ç£„É´„Çø„Éº„Éë„Éç„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
        .filter-panel {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
            /* ÂàùÊúü„ÅØÈùûË°®Á§∫ */
        }

        .filter-group-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--primary-gray);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .filter-options-scroll {
            max-height: 120px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px;
        }

        .filter-checkbox-label {
            font-size: 0.8rem;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .filter-checkbox-label:hover {
            background: #e0e0e0;
        }

        input[type="checkbox"]:checked+.filter-checkbox-label {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ */
        .nav-dropdown {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .record-button {
            background: linear-gradient(135deg, var(--gold) 0%, #b8892d 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
        }

        .record-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.6);
            color: white;
        }

        .nav-dropdown-menu {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            min-width: 200px;
            overflow: hidden;
        }

        .nav-dropdown-menu .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            transition: background 0.2s;
        }

        .nav-dropdown-menu .dropdown-item:hover {
            background: #f5f5f5;
        }

        .nav-dropdown-menu .dropdown-divider {
            margin: 0;
        }

        .notification-badge {
            background: #dc3545;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }
    </style>

</head>

<body>
    <!-- Âè≥‰∏ä„ÅÆ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ -->
    <div class="nav-dropdown dropdown">
        <button class="record-button dropdown-toggle" type="button" id="navDropdown" data-bs-toggle="dropdown"
            aria-expanded="false">
            üìù „É°„Éã„É•„Éº
        </button>
        <ul class="dropdown-menu nav-dropdown-menu dropdown-menu-end" aria-labelledby="navDropdown">
            <li><a class="dropdown-item" href="../index.html">üè† „Éõ„Éº„É†„Å´Êàª„Çã</a></li>
            <li><a class="dropdown-item" href="../mypage/index.html">üë§ „Éû„Ç§„Éö„Éº„Ç∏</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="../mahjong/index.html">üìä „É©„É≥„Ç≠„É≥„Ç∞</a></li>
            <li><a class="dropdown-item" href="../mahjong/record.html">üìù Ë®òÈå≤„Åô„Çã</a></li>
            <li><a class="dropdown-item" href="../mahjong/users/index.html">üë• „É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</a></li>
            <li><a class="dropdown-item" href="../mahjong/team/index.html">üèÖ „ÉÅ„Éº„É†ÁÆ°ÁêÜ <span id="team-notification-badge"
                        class="notification-badge" style="display:none;">0</span></a></li>
            <li><a class="dropdown-item" href="../badge/list.html">üìõ „Éê„ÉÉ„Ç∏‰∏ÄË¶ß</a></li>
            <li><a class="dropdown-item" href="../badge/shop.html">üõí „Éê„ÉÉ„Ç∏„Ç∑„Éß„ÉÉ„Éó</a></li>
            <li><a class="dropdown-item" href="../ranking/index.html">üí∞ Ë≥áÁî£„É©„É≥„Ç≠„É≥„Ç∞</a></li>
            <li class="admin-only" style="display:none;"><a class="dropdown-item" href="../omikuji/index.html">üéã
                    „Åä„Åø„Åè„Åò</a></li>
            <li class="admin-only" style="display:none;">
                <hr class="dropdown-divider">
            </li>
            <li class="admin-only" style="display:none;">
                <a class="dropdown-item" href="./index.html">‚öôÔ∏è ÁÆ°ÁêÜÁîªÈù¢</a>
            </li>
        </ul>
    </div>

    <div class="container py-5">
        <!-- Êàª„Çã„Éú„Çø„É≥ -->
        <div class="mb-4">
            <a href="../index.html" class="back-button">
                ‚Üê „Éõ„Éº„É†„Å´Êàª„Çã
            </a>
        </div>


        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="text-center mb-5">
            <h1 class="page-header display-4 fw-bold mb-3">‚öôÔ∏è ÁÆ°ÁêÜÁîªÈù¢</h1>
        </header>

        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
        <div id="loading" class="loading">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Ë™çË®º„ÇíÁ¢∫Ë™ç‰∏≠...</p>
        </div>

        <!-- „Ç¢„ÇØ„Çª„ÇπÊãíÂê¶ -->
        <div id="access-denied" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">üö´</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">„Ç¢„ÇØ„Çª„ÇπÊ®©Èôê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h2>
            <p class="text-muted mt-3">„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ„Åß„Åô„ÄÇ</p>
            <a href="../index.html" class="btn btn-primary mt-3">„Éõ„Éº„É†„Å´Êàª„Çã</a>

        </div>

        <!-- Êú™„É≠„Ç∞„Ç§„É≥ -->
        <div id="login-prompt" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">üîê</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô</h2>
            <p class="text-muted mt-3">ÁÆ°ÁêÜÁîªÈù¢„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Å´„ÅØ„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
            <button onclick="loginWithDiscord()" class="btn btn-primary mt-3">
                <img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0a69f118df70ad7828d4_icon_clyde_blurple_RGB.svg"
                    alt="Discord" style="width: 20px; margin-right: 8px;">
                Discord„Åß„É≠„Ç∞„Ç§„É≥
            </button>
        </div>

        <!-- ÁÆ°ÁêÜ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div id="admin-content" class="row justify-content-center" style="display: none;">
            <div class="col-12 col-lg-12">
                <div class="content-card">
                    <div class="mb-4">
                        <ul class="nav nav-pills" id="adminTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="logs-tab" data-bs-toggle="pill"
                                    data-bs-target="#logs-pane" type="button" role="tab"
                                    onclick="fetchActivityLogs()">üìù
                                    Ê¥ªÂãï„É≠„Ç∞</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="users-tab" data-bs-toggle="pill"
                                    data-bs-target="#users-pane" type="button" role="tab" onclick="fetchUsers()">üë•
                                    „É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="badges-tab" data-bs-toggle="pill"
                                    data-bs-target="#badges-pane" type="button" role="tab" onclick="fetchBadges()">üìõ
                                    „Éê„ÉÉ„Ç∏ÁÆ°ÁêÜ</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="records-tab" data-bs-toggle="pill"
                                    data-bs-target="#records-pane" type="button" role="tab">üèÜ Â§ß‰ºöË®òÈå≤ÁÆ°ÁêÜ</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="team-requests-tab" data-bs-toggle="pill"
                                    data-bs-target="#team-requests-pane" type="button" role="tab"
                                    onclick="fetchTeamRequests()">üèÖ
                                    „ÉÅ„Éº„É†ÁÆ°ÁêÜÁî≥Ë´ã <span id="team-requests-badge" class="badge bg-danger"
                                        style="display: none;">0</span></button>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content" id="adminTabContent">
                        <!-- Ë®òÈå≤ÁÆ°ÁêÜ„Çø„Éñ -->
                        <div class="tab-pane fade" id="records-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">üèÜ
                                    Â§ß‰ºöË®òÈå≤ÁÆ°ÁêÜ</h2>
                                <div class="csv-actions">
                                    <button onclick="document.getElementById('csv-import-input').click()"
                                        class="btn btn-outline-primary btn-sm">
                                        üì• CSV„Ç§„É≥„Éù„Éº„Éà
                                    </button>
                                    <input type="file" id="csv-import-input" style="display: none;" accept=".csv"
                                        onchange="handleCSVImport(event)">
                                    <button onclick="exportToCSV()" class="btn btn-outline-secondary btn-sm">
                                        üì§ CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                    </button>
                                </div>
                            </div>

                            <!-- Â§ß‰ºöË®òÈå≤‰∏ÄË¶ß -->
                            <div class="admin-section">
                                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">üìã ÊúÄËøë„ÅÆË®òÈå≤</h5>
                                    <div class="d-flex gap-2 mt-2 mt-md-0">
                                        <button onclick="toggleFilterPanel()" class="btn btn-outline-primary btn-sm">üîç
                                            „Éï„Ç£„É´„Çø„Éº</button>
                                        <button onclick="openRecordModal()"
                                            class="btn btn-primary btn-sm">Ë®òÈå≤„ÇíËøΩÂä†</button>
                                    </div>
                                </div>

                                <!-- „Éï„Ç£„É´„Çø„Éë„Éç„É´ -->
                                <div id="filter-panel" class="filter-panel shadow-sm">
                                    <div class="row">
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">üë§ „Ç¢„Ç´„Ç¶„É≥„Éà</div>
                                            <div id="filter-accounts" class="filter-options-scroll">
                                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">üèÜ Â§ß‰ºöÂêç</div>
                                            <div id="filter-tournaments" class="filter-options-scroll">
                                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">üö© „ÉÅ„Éº„É†Âêç</div>
                                            <div id="filter-teams" class="filter-options-scroll">
                                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">üÄÑ „É¢„Éº„Éâ</div>
                                            <div id="filter-modes" class="filter-options-scroll">
                                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">‚öîÔ∏è Ë©¶ÂêàÊñπÊ≥ï</div>
                                            <div id="filter-match-modes" class="filter-options-scroll">
                                                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                                            </div>
                                        </div>

                                    </div>
                                    <div class="d-flex justify-content-end gap-2 mt-2">
                                        <button onclick="clearFilters()"
                                            class="btn btn-link btn-sm text-muted text-decoration-none">„É™„Çª„ÉÉ„Éà</button>
                                        <button onclick="toggleFilterPanel()"
                                            class="btn btn-secondary btn-sm">Èñâ„Åò„Çã</button>
                                    </div>
                                </div>

                                <div class="table-responsive">

                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th onclick="sortRecords('event_datetime')" class="sortable"
                                                    id="th-event_datetime">Êó•ÊôÇ</th>
                                                <th onclick="sortRecords('account_name')" class="sortable"
                                                    id="th-account_name">„Ç¢„Ç´„Ç¶„É≥„Éà</th>
                                                <th onclick="sortRecords('tournament_type')" class="sortable"
                                                    id="th-tournament_type">Â§ß‰ºö/„É¢„Éº„Éâ</th>
                                                <th onclick="sortRecords('final_score')" class="sortable"
                                                    id="th-final_score">ÂæóÁÇπ</th>
                                                <th onclick="sortRecords('rank')" class="sortable" id="th-rank">È†Ü‰Ωç</th>
                                                <th onclick="sortRecords('matches_played')" class="sortable"
                                                    id="th-matches_played">ÂØæÂ±ÄÊï∞</th>
                                                <th>Êìç‰Ωú</th>
                                            </tr>
                                        </thead>

                                        <tbody id="records-list-body">
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="text-center mt-4 p-3 rounded" style="background: #f8f9fa;">
                                <p class="mb-0">üìç „Éö„Éº„Ç∏„ÅÆ„Éë„Çπ: <code>/admin/index.html</code></p>
                            </div>
                        </div>

                        <!-- „É¶„Éº„Ç∂„Éº‰∏ÄË¶ß„Çø„Éñ -->
                        <div class="tab-pane fade" id="users-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">üë•
                                DiscordÈÄ£Êê∫„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</h2>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>„Ç¢„Éê„Çø„Éº</th>
                                            <th>DiscordÂêç / „Éã„ÉÉ„ÇØ„Éç„Éº„É†</th>
                                            <th>Discord ID</th>
                                            <th>ÊúÄÁµÇÊõ¥Êñ∞</th>
                                            <th>ÊâÄÊåÅÈáë</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-list-body">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- „ÉÅ„Éº„É†ÁÆ°ÁêÜÁî≥Ë´ã„Çø„Éñ -->
                        <div class="tab-pane fade" id="team-requests-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">üèÖ
                                „ÉÅ„Éº„É†ÁÆ°ÁêÜÁî≥Ë´ã</h2>

                            <!-- ËøΩÊîæÁî≥Ë´ã -->
                            <div class="admin-section">
                                <h5 class="mb-3">üö´ „É°„É≥„Éê„ÉºËøΩÊîæÁî≥Ë´ã</h5>
                                <div id="kick-requests-list">
                                    <p class="text-muted">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                                </div>
                            </div>

                            <!-- Ëß£Êï£Áî≥Ë´ã -->
                            <div class="admin-section">
                                <h5 class="mb-3">üí• „ÉÅ„Éº„É†Ëß£Êï£Áî≥Ë´ã</h5>
                                <div id="dissolution-requests-list">
                                    <p class="text-muted">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                                </div>
                            </div>
                        </div>

                        <!-- „Éê„ÉÉ„Ç∏ÁÆ°ÁêÜ„Çø„Éñ -->
                        <div class="tab-pane fade" id="badges-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">üìõ
                                    „Éê„ÉÉ„Ç∏„Éû„Çπ„Çø„ÉºÁÆ°ÁêÜ</h2>
                                <div class="d-flex gap-2">
                                    <button onclick="document.getElementById('badge-bulk-upload').click()"
                                        class="btn btn-outline-success btn-sm">
                                        üñºÔ∏è ÁîªÂÉè‰∏ÄÊã¨„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                                    </button>
                                    <input type="file" id="badge-bulk-upload" style="display: none;" accept="image/*"
                                        multiple onchange="handleBulkBadgeUpload(event)">
                                    <button onclick="document.getElementById('badge-csv-import').click()"
                                        class="btn btn-outline-primary btn-sm">
                                        üì• CSV„Ç§„É≥„Éù„Éº„Éà
                                    </button>
                                    <input type="file" id="badge-csv-import" style="display: none;" accept=".csv"
                                        onchange="handleBadgeCSVImport(event)">
                                    <button onclick="exportBadgesToCSV()" class="btn btn-outline-secondary btn-sm">
                                        üì§ CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                    </button>
                                    <button onclick="openBadgeModal()" class="btn btn-primary">Êñ∞Ë¶è„Éê„ÉÉ„Ç∏ÁôªÈå≤</button>
                                </div>
                            </div>
                            <div class="row g-3" id="badges-list">
                                <!-- „Éê„ÉÉ„Ç∏„Ç´„Éº„Éâ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                                <p class="text-center text-muted py-5">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
                            </div>
                        </div>

                        <!-- Ê¥ªÂãï„É≠„Ç∞„Çø„Éñ -->
                        <div class="tab-pane fade show active" id="logs-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">üìù
                                    ÂÖ®„É¶„Éº„Ç∂„ÉºÊ¥ªÂãï„É≠„Ç∞</h2>
                                <button onclick="fetchActivityLogs()" class="btn btn-outline-primary btn-sm">üîÑ
                                    Êõ¥Êñ∞</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle" style="font-size: 0.9rem;">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Êó•ÊôÇ</th>
                                            <th>„É¶„Éº„Ç∂„Éº</th>
                                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                            <th>ÂÜÖÂÆπ / ÂØæË±°</th>
                                            <th>ÈáëÈ°ç</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="logs-list-body">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">Ë™≠„ÅøËæº„Åø‰∏≠...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
                            <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
                                <button id="prev-logs-btn" onclick="changeLogsPage(-1)"
                                    class="btn btn-outline-secondary btn-sm" disabled>‚óÄ Ââç„Å∏</button>
                                <span id="logs-page-info" class="fw-bold">1 / -</span>
                                <button id="next-logs-btn" onclick="changeLogsPage(1)"
                                    class="btn btn-outline-secondary btn-sm">Ê¨°„Å∏ ‚ñ∂</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ë®òÈå≤Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
            <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="recordModalLabel">Â§ß‰ºöË®òÈå≤Á∑®ÈõÜ</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="record-form">
                                <input type="hidden" id="match-id">

                                <!-- ÂÖ±ÈÄöÈ†ÖÁõÆ -->
                                <div class="admin-section mb-4" style="border-left-color: #007bff;">
                                    <h6 class="mb-3 text-primary fw-bold">ÂÖ±ÈÄöÈ†ÖÁõÆ</h6>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <label for="event_datetime" class="form-label">Êó•ÊôÇ</label>
                                            <input type="datetime-local" class="form-control" id="event_datetime"
                                                required>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label for="tournament_type" class="form-label">Â§ß‰ºöÂêç</label>
                                            <input type="text" class="form-control" id="tournament_type">
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <label for="mahjong_mode" class="form-label">È∫ªÈõÄ/„É¢„Éº„Éâ</label>
                                            <select class="form-select" id="mahjong_mode">
                                                <option value="ÂõõÈ∫ª">ÂõõÈ∫ª</option>
                                                <option value="‰∏âÈ∫ª">‰∏âÈ∫ª</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <label for="match_mode" class="form-label">Ë©¶ÂêàÊñπÂºè</label>
                                            <input type="text" class="form-control" id="match_mode" placeholder="ÂÄã‰∫∫Êà¶">
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <label for="hand_count" class="form-label">Â±ÄÊï∞</label>
                                            <input type="number" class="form-control" id="hand_count">
                                        </div>

                                        <!-- „É´„Éº„É´Ë©≥Á¥∞Ë®≠ÂÆö -->
                                        <div class="col-md-3 mb-3">
                                            <label for="dist_points" class="form-label">ÈÖçÁµ¶ÁÇπ (ÂàùÊúüÁÇπ)</label>
                                            <select class="form-select" id="dist_points">
                                                <option value="25000">25000 (ÂõõÈ∫ªÊ®ôÊ∫ñ)</option>
                                                <option value="30000">30000 (‰∏âÈ∫ªÊ®ôÊ∫ñ)</option>
                                                <option value="100000">100000 („Ç§„É≥„Éï„É¨)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">È£õ„Å≥Ë≥ûË®≠ÂÆö</label>
                                            <div class="form-check form-switch mt-1">
                                                <input class="form-check-input" type="checkbox" id="opt_tobi">
                                                <label class="form-check-label" for="opt_tobi">ÊúâÂäπ („Ç¢„É™)</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">„ÇÑ„Åç„Å®„ÇäË®≠ÂÆö</label>
                                            <div class="form-check form-switch mt-1">
                                                <input class="form-check-input" type="checkbox" id="opt_yakitori">
                                                <label class="form-check-label" for="opt_yakitori">ÊúâÂäπ („Ç¢„É™)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- „Éó„É¨„Ç§„É§„ÉºÂà•È†ÖÁõÆ -->
                                <div id="players-edit-container">
                                    <div class="row g-3">
                                        <!-- 4‰∫∫ÂàÜ„ÅÆÂÖ•ÂäõÊ¨Ñ„ÇíJS„ÅßÁîüÊàê„Åô„Çã„Åã„ÄÅHTML„ÅßÁõ¥Êé•Êõ∏„Åè -->
                                        <!-- ‰ªäÂõû„ÅØÂèØË™≠ÊÄß„Å®„É°„É≥„ÉÜ„Éä„É≥„ÇπÊÄß„ÅÆ„Åü„ÇÅ„Å´HTML„Å´4„Å§ÈÖçÁΩÆ„Åó„Åæ„Åô -->
                                        <!-- ÂêÑ„Éï„Ç£„Éº„É´„ÉâÂêç„ÅØ record[0].account_name „ÅÆ„Çà„ÅÜ„Å´JS„ÅßÊâ±„ÅÜ„Åü„ÇÅ„ÄÅ„ÇØ„É©„Çπ„ÅßË≠òÂà•„Åó„Åæ„Åô -->

                                        <!-- „Éó„É¨„Ç§„É§„Éº 1 -->
                                        <div class="col-md-6">
                                            <div class="card p-3 shadow-sm player-edit-card" data-index="0">
                                                <h6
                                                    class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                    <span>„Éó„É¨„Ç§„É§„Éº 1</span>
                                                    <span class="badge bg-secondary player-discord-id-display"
                                                        style="font-size: 0.65rem;">ID: -</span>
                                                </h6>
                                                <input type="hidden" class="player-record-id">
                                                <input type="hidden" class="player-discord-id">
                                                <div class="row g-2">
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç</label>
                                                        <select class="form-select form-select-sm player-account-name">
                                                            <option value="">ÈÅ∏Êäû...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„ÉÅ„Éº„É†Âêç</label>
                                                        <select class="form-select form-select-sm player-team-name">
                                                            <option value="">(„Å™„Åó)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted fw-bold text-primary">Á¥†ÁÇπ
                                                            (ÊåÅ„Å°ÁÇπ)</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-raw-points border-primary"
                                                            placeholder="25000">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">Âíå‰∫ÜÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-win-count">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">ÊîæÈäÉÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-deal-in-count">
                                                    </div>

                                                    <!-- Ëá™ÂãïË®àÁÆó„Ç®„É™„Ç¢ -->
                                                    <div class="col-12 mt-2">
                                                        <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                            style="font-size: 0.85rem;">
                                                            <div>
                                                                <span class="text-muted small">È†Ü‰Ωç:</span>
                                                                <span class="fw-bold fs-6 player-rank-display">-</span>‰Ωç
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">„Çπ„Ç≥„Ç¢:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-final-score-display">-</span>
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">Â†±ÈÖ¨:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-reward-preview">-</span>
                                                            </div>
                                                        </div>
                                                        <input type="hidden" class="player-rank">
                                                        <input type="hidden" class="player-final-score">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- „Éó„É¨„Ç§„É§„Éº 2 -->
                                        <div class="col-md-6">
                                            <div class="card p-3 shadow-sm player-edit-card" data-index="1">
                                                <h6
                                                    class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                    <span>„Éó„É¨„Ç§„É§„Éº 2</span>
                                                    <span class="badge bg-secondary player-discord-id-display"
                                                        style="font-size: 0.65rem;">ID: -</span>
                                                </h6>
                                                <input type="hidden" class="player-record-id">
                                                <input type="hidden" class="player-discord-id">
                                                <div class="row g-2">
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç</label>
                                                        <select class="form-select form-select-sm player-account-name">
                                                            <option value="">ÈÅ∏Êäû...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„ÉÅ„Éº„É†Âêç</label>
                                                        <select class="form-select form-select-sm player-team-name">
                                                            <option value="">(„Å™„Åó)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted fw-bold text-primary">Á¥†ÁÇπ
                                                            (ÊåÅ„Å°ÁÇπ)</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-raw-points border-primary"
                                                            placeholder="25000">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">Âíå‰∫ÜÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-win-count">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">ÊîæÈäÉÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-deal-in-count">
                                                    </div>

                                                    <!-- Ëá™ÂãïË®àÁÆó„Ç®„É™„Ç¢ -->
                                                    <div class="col-12 mt-2">
                                                        <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                            style="font-size: 0.85rem;">
                                                            <div>
                                                                <span class="text-muted small">È†Ü‰Ωç:</span>
                                                                <span class="fw-bold fs-6 player-rank-display">-</span>‰Ωç
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">„Çπ„Ç≥„Ç¢:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-final-score-display">-</span>
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">Â†±ÈÖ¨:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-reward-preview">-</span>
                                                            </div>
                                                        </div>
                                                        <input type="hidden" class="player-rank">
                                                        <input type="hidden" class="player-final-score">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- „Éó„É¨„Ç§„É§„Éº 3 -->
                                        <div class="col-md-6">
                                            <div class="card p-3 shadow-sm player-edit-card" data-index="2">
                                                <h6
                                                    class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                    <span>„Éó„É¨„Ç§„É§„Éº 3</span>
                                                    <span class="badge bg-secondary player-discord-id-display"
                                                        style="font-size: 0.65rem;">ID: -</span>
                                                </h6>
                                                <input type="hidden" class="player-record-id">
                                                <input type="hidden" class="player-discord-id">
                                                <div class="row g-2">
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç</label>
                                                        <select class="form-select form-select-sm player-account-name">
                                                            <option value="">ÈÅ∏Êäû...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„ÉÅ„Éº„É†Âêç</label>
                                                        <select class="form-select form-select-sm player-team-name">
                                                            <option value="">(„Å™„Åó)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted fw-bold text-primary">Á¥†ÁÇπ
                                                            (ÊåÅ„Å°ÁÇπ)</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-raw-points border-primary"
                                                            placeholder="25000">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">Âíå‰∫ÜÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-win-count">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">ÊîæÈäÉÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-deal-in-count">
                                                    </div>

                                                    <!-- Ëá™ÂãïË®àÁÆó„Ç®„É™„Ç¢ -->
                                                    <div class="col-12 mt-2">
                                                        <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                            style="font-size: 0.85rem;">
                                                            <div>
                                                                <span class="text-muted small">È†Ü‰Ωç:</span>
                                                                <span class="fw-bold fs-6 player-rank-display">-</span>‰Ωç
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">„Çπ„Ç≥„Ç¢:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-final-score-display">-</span>
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">Â†±ÈÖ¨:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-reward-preview">-</span>
                                                            </div>
                                                        </div>
                                                        <input type="hidden" class="player-rank">
                                                        <input type="hidden" class="player-final-score">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- „Éó„É¨„Ç§„É§„Éº 4 -->
                                        <div class="col-md-6">
                                            <div class="card p-3 shadow-sm player-edit-card" data-index="3">
                                                <h6
                                                    class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                    <span>„Éó„É¨„Ç§„É§„Éº 4</span>
                                                    <span class="badge bg-secondary player-discord-id-display"
                                                        style="font-size: 0.65rem;">ID: -</span>
                                                </h6>
                                                <input type="hidden" class="player-record-id">
                                                <input type="hidden" class="player-discord-id">
                                                <div class="row g-2">
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„Ç¢„Ç´„Ç¶„É≥„ÉàÂêç</label>
                                                        <select class="form-select form-select-sm player-account-name">
                                                            <option value="">ÈÅ∏Êäû...</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted">„ÉÅ„Éº„É†Âêç</label>
                                                        <select class="form-select form-select-sm player-team-name">
                                                            <option value="">(„Å™„Åó)</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-6 mb-2">
                                                        <label class="small text-muted fw-bold text-primary">Á¥†ÁÇπ
                                                            (ÊåÅ„Å°ÁÇπ)</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-raw-points border-primary"
                                                            placeholder="25000">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">Âíå‰∫ÜÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-win-count">
                                                    </div>
                                                    <div class="col-3 mb-2">
                                                        <label class="small text-muted">ÊîæÈäÉÊï∞</label>
                                                        <input type="number"
                                                            class="form-control form-control-sm player-deal-in-count">
                                                    </div>

                                                    <!-- Ëá™ÂãïË®àÁÆó„Ç®„É™„Ç¢ -->
                                                    <div class="col-12 mt-2">
                                                        <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                            style="font-size: 0.85rem;">
                                                            <div>
                                                                <span class="text-muted small">È†Ü‰Ωç:</span>
                                                                <span class="fw-bold fs-6 player-rank-display">-</span>‰Ωç
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">„Çπ„Ç≥„Ç¢:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-final-score-display">-</span>
                                                            </div>
                                                            <div>
                                                                <span class="text-muted small">Â†±ÈÖ¨:</span>
                                                                <span
                                                                    class="fw-bold fs-6 player-reward-preview">-</span>
                                                            </div>
                                                        </div>
                                                        <input type="hidden" class="player-rank">
                                                        <input type="hidden" class="player-final-score">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="button" class="btn btn-primary" onclick="saveRecord()">‰øùÂ≠ò„Åô„Çã</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „Éê„ÉÉ„Ç∏ÁôªÈå≤„ÉªÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
            <div class="modal fade" id="badgeModal" tabindex="-1" aria-labelledby="badgeModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="badgeModalLabel">„Éê„ÉÉ„Ç∏ÁôªÈå≤„ÉªÁ∑®ÈõÜ</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="badge-form">
                                <input type="hidden" id="badge-id">
                                <div class="mb-3">
                                    <label for="badge-name" class="form-label">„Éê„ÉÉ„Ç∏Âêç</label>
                                    <input type="text" class="form-control" id="badge-name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="badge-description" class="form-label">Ë™¨ÊòéÊñá</label>
                                    <textarea class="form-control" id="badge-description" rows="2"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="badge-image-file" class="form-label">ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</label>
                                    <input type="file" class="form-control" id="badge-image-file" accept="image/*">
                                    <div id="badge-image-preview" class="mt-2 text-center" style="display: none;">
                                        <img src="" style="max-height: 100px; border-radius: 8px;" class="shadow-sm">
                                    </div>
                                    <input type="hidden" id="badge-image-url">
                                </div>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label for="badge-weight" class="form-label">„Ç¨„ÉÅ„É£Èáç„Åø (ÈùûË°®Á§∫Áî®)</label>
                                        <input type="number" class="form-control" id="badge-weight" value="10">
                                        <small class="text-muted">0„Å´Ë®≠ÂÆö„Åô„Çã„Å®„ÄåÈùûÂ£≤ÂìÅ„ÄçÊâ±„ÅÑ„Å´„Å™„Çä„Åæ„Åô</small>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="badge-price" class="form-label">ÈáëÈ°ç („Ç≥„Ç§„É≥)</label>
                                        <input type="number" class="form-control" id="badge-price" value="0">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="badge-fixed-rarity" class="form-label">„É¨„Ç¢„É™„ÉÜ„Ç£ (Âõ∫ÂÆöË°®Á§∫Âêç)</label>
                                    <input type="text" class="form-control" id="badge-fixed-rarity"
                                        placeholder="Á©∫„Å´„Åô„Çã„Å®‰æ°Ê†º„ÅßËá™ÂãïÂà§ÂÆö">
                                </div>
                                <div class="mb-3">
                                    <label for="badge-requirements" class="form-label">Áç≤ÂæóÊù°‰ª∂</label>
                                    <textarea class="form-control" id="badge-requirements" rows="2"
                                        placeholder="‰æãÔºöÂ§ß‰ºö„ÅßÂÑ™Âãù„Åô„Çã„ÄÅÁ≠â"></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label for="badge-stock" class="form-label">ÊÆã„ÇäÂÄãÊï∞ (Âú®Â∫´)</label>
                                        <input type="number" class="form-control" id="badge-stock" value="999">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="badge-sort-order" class="form-label">Ë°®Á§∫È†Ü (Â∞è„Åï„ÅÑÈ†Ü)</label>
                                        <input type="number" class="form-control" id="badge-sort-order" value="0">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Ê®©Âà©ËÄÖÔºàÂ£≤‰∏ä10%ÈÇÑÂÖÉÂÖàÔºâ</label>
                                    <div class="dropdown">
                                        <button
                                            class="btn btn-outline-secondary w-100 text-start d-flex align-items-center justify-content-between dropdown-toggle"
                                            type="button" id="badge-owner-dropdown" data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                            <span id="selected-owner-label">„Å™„ÅóÔºàÊ®©Âà©ËÄÖ„Å™„ÅóÔºâ</span>
                                        </button>
                                        <ul class="dropdown-menu w-100" id="badge-owner-list"
                                            style="max-height: 300px; overflow-y: auto;">
                                            <!-- JS„Åß„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß„ÇíÁîüÊàê -->
                                        </ul>
                                        <input type="hidden" id="badge-owner" value="">
                                    </div>
                                    <small class="text-muted">ÈÅ∏Êäû„Åó„Åü„É¶„Éº„Ç∂„Éº„Å´„Éê„ÉÉ„Ç∏Â£≤‰∏ä„ÅÆ10%„ÅåÈÇÑÂÖÉ„Åï„Çå„Åæ„Åô</small>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="button" class="btn btn-primary" onclick="saveBadge()">‰øùÂ≠ò„Åô„Çã</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „Ç≥„Ç§„É≥Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
            <div class="modal fade" id="coinModal" tabindex="-1" aria-labelledby="coinModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="coinModalLabel">„Ç≥„Ç§„É≥Á∑®ÈõÜ</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-3">
                                <strong id="coin-edit-user-name">„É¶„Éº„Ç∂„ÉºÂêç</strong>
                            </div>
                            <input type="hidden" id="coin-edit-user-id">
                            <div class="mb-3">
                                <label for="coin-amount" class="form-label">ÊâÄÊåÅ„Ç≥„Ç§„É≥</label>
                                <input type="number" class="form-control text-center fs-4" id="coin-amount" value="0">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary w-100" onclick="saveUserCoins()">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- „Éê„ÉÉ„Ç∏‰ªò‰∏é„É¢„Éº„ÉÄ„É´ -->
            <div class="modal fade" id="badgeGrantModal" tabindex="-1" aria-labelledby="badgeGrantModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="badgeGrantModalLabel">„Éê„ÉÉ„Ç∏‰ªò‰∏é</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-3">
                                <strong id="badge-grant-user-name">„É¶„Éº„Ç∂„ÉºÂêç</strong>
                            </div>
                            <input type="hidden" id="badge-grant-user-id">
                            <div class="mb-3">
                                <label class="form-label">‰ªò‰∏é„Åô„Çã„Éê„ÉÉ„Ç∏„ÇíÈÅ∏Êäû</label>
                                <div id="badge-grant-list" class="row g-2" style="max-height: 300px; overflow-y: auto;">
                                    <!-- JS„ÅßÁîüÊàê -->
                                </div>
                            </div>
                            <div id="badge-grant-owned" class="mt-3">
                                <label class="form-label text-muted small">ÁèæÂú®ÊâÄÊåÅ„Åó„Å¶„ÅÑ„Çã„Éê„ÉÉ„Ç∏</label>
                                <div id="badge-grant-owned-list" class="d-flex flex-wrap gap-1">
                                    <!-- JS„ÅßÁîüÊàê -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
                            <button type="button" class="btn btn-primary"
                                onclick="grantMultiBadges()">ÈÅ∏Êäû„Åó„Åü„Éê„ÉÉ„Ç∏„Çí‰ªò‰∏é</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
            <div id="loading-overlay" class="loading-overlay">
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>


            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <!-- Supabase -->
            <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
            <!-- SupabaseË®≠ÂÆö -->
            <script src="../js/supabase-config.js"></script>
            <script src="../js/auth-guard.js"></script>
            <script src="../js/navigation.js"></script>
            <!-- ÁÆ°ÁêÜ„É≠„Ç∏„ÉÉ„ÇØ -->
            <script src="../js/admin_v2.js?v=20260111_04"></script>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    initAccordionNav('../');
                });
            </script>


            <script>
                // admin/index.html ÂÜÖ„ÅÆ ADMIN_DISCORD_IDS ÂÆöÁæ©„ÅØÂâäÈô§ (supabase-config.js „Çí‰ΩøÁî®)


                // ÁÆ°ÁêÜËÄÖ„ÉÅ„Çß„ÉÉ„ÇØ
                async function checkAdminAccess() {
                    const loading = document.getElementById('loading');
                    const accessDenied = document.getElementById('access-denied');
                    const loginPrompt = document.getElementById('login-prompt');
                    const adminContent = document.getElementById('admin-content');

                    const user = await getCurrentUser();

                    if (!user) {
                        // Êú™„É≠„Ç∞„Ç§„É≥
                        loading.style.display = 'none';
                        loginPrompt.style.display = 'block';
                        return;
                    }

                    const discordId = user.user_metadata.provider_id;
                    console.log('Discord ID:', discordId); // „Éá„Éê„ÉÉ„Ç∞Áî®

                    // ÁÆ°ÁêÜËÄÖ„É™„Çπ„Éà„ÅåÁ©∫„ÅÆÂ†¥Âêà„ÅØÂÖ®Âì°„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩÔºàÂàùÊúüË®≠ÂÆöÁî®Ôºâ
                    if (ADMIN_DISCORD_IDS.length === 0 || ADMIN_DISCORD_IDS.includes(discordId)) {
                        loading.style.display = 'none';
                        adminContent.style.display = 'flex';
                        // Ê¥ªÂãï„É≠„Ç∞„ÇíËá™ÂãïË™≠„ÅøËæº„Åø
                        fetchActivityLogs();
                    } else {
                        loading.style.display = 'none';
                        accessDenied.style.display = 'block';
                    }
                }

                document.addEventListener('DOMContentLoaded', checkAdminAccess);
            </script>
        </div> <!-- admin-content -->
    </div> <!-- container -->
    <!-- „ÉÅ„Éº„É†ÈÄöÁü•„Éê„ÉÉ„Ç∏ -->
    <script>
        async function checkTeamNotifications() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) return;

            // „Å™„Çä„Åô„Åæ„ÅóÂØæÂøú
            const impersonated = getImpersonatedUser();
            const discordId = impersonated ? impersonated.discord_user_id : user.user_metadata.provider_id;

            const { data: myTeams } = await supabaseClient
                .from('teams')
                .select('id')
                .eq('creator_discord_id', discordId);

            if (!myTeams || myTeams.length === 0) return;

            const teamIds = myTeams.map(t => t.id);

            const { data: pendingRequests } = await supabaseClient
                .from('team_join_requests')
                .select('id')
                .in('team_id', teamIds)
                .in('status', ['pending', 'leave_pending']);

            const count = pendingRequests?.length || 0;

            if (count > 0) {
                const badge = document.getElementById('team-notification-badge');
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = 'inline';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkTeamNotifications);
    </script>
</body>

</html>