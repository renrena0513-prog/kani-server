<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã‹ã«ã‚µãƒ¼ãƒãƒ¼ - ç®¡ç†ç”»é¢">
    <title>ç®¡ç†ç”»é¢ | ã‹ã«ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Bootswatch Lux (Bootstrap 5.3.3) -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-gray: #3a3a4a;
            --deep-gray: #252530;
            --cream: #faf5e8;
            --gold: #d4a853;
            --font-title: 'Noto Serif JP', serif;
            --font-body: 'M PLUS Rounded 1c', sans-serif;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(180deg, #3a3a4a 0%, #2d2d3a 50%, #252530 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .page-header {
            font-family: var(--font-title);
            color: var(--cream);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .back-button {
            font-family: var(--font-body);
            font-size: 1rem;
            padding: 10px 25px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .admin-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--gold);
        }

        .event-list-item {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .event-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .event-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            background: #f0f0f0;
        }

        .csv-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        th.sortable {
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: background 0.2s;
        }

        th.sortable:hover {
            background-color: #f0f0f0 !important;
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: 8px;
            color: #ccc;
            font-size: 0.8em;
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--gold);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--gold);
        }


        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            visibility: hidden;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .filter-panel {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
            /* åˆæœŸã¯éè¡¨ç¤º */
        }

        .filter-group-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--primary-gray);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .filter-options-scroll {
            max-height: 120px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px;
        }

        .filter-checkbox-label {
            font-size: 0.8rem;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .filter-checkbox-label:hover {
            background: #e0e0e0;
        }

        input[type="checkbox"]:checked+.filter-checkbox-label {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ */
        .nav-dropdown {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .record-button {
            background: linear-gradient(135deg, var(--gold) 0%, #b8892d 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
        }

        .record-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.6);
            color: white;
        }

        .nav-dropdown-menu {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            min-width: 200px;
            overflow: hidden;
        }

        .nav-dropdown-menu .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            transition: background 0.2s;
        }

        .nav-dropdown-menu .dropdown-item:hover {
            background: #f5f5f5;
        }

        .nav-dropdown-menu .dropdown-divider {
            margin: 0;
        }

        .notification-badge {
            background: #dc3545;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }
    </style>

</head>

<body>
    <!-- å³ä¸Šã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
    <div class="nav-dropdown dropdown">
        <button class="record-button dropdown-toggle" type="button" id="navDropdown" data-bs-toggle="dropdown"
            aria-expanded="false">
            ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        </button>
        <ul class="dropdown-menu nav-dropdown-menu dropdown-menu-end" aria-labelledby="navDropdown">
            <li><a class="dropdown-item" href="../index.html">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a></li>
            <li><a class="dropdown-item" href="../mypage/index.html">ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="../mahjong/index.html">ğŸ“Š ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a></li>
            <li><a class="dropdown-item" href="../mahjong/record.html">ğŸ“ è¨˜éŒ²ã™ã‚‹</a></li>
            <li><a class="dropdown-item" href="../mahjong/users/index.html">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
            <li><a class="dropdown-item" href="../mahjong/team/index.html">ğŸ… ãƒãƒ¼ãƒ ç®¡ç† <span id="team-notification-badge"
                        class="notification-badge" style="display:none;">0</span></a></li>
        </ul>
    </div>

    <div class="container py-5">
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="mb-4">
            <a href="../index.html" class="back-button">
                â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </a>
        </div>


        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="text-center mb-5">
            <h1 class="page-header display-4 fw-bold mb-3">âš™ï¸ ç®¡ç†ç”»é¢</h1>
        </header>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div id="loading" class="loading">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">èªè¨¼ã‚’ç¢ºèªä¸­...</p>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ -->
        <div id="access-denied" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">ğŸš«</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“</h2>
            <p class="text-muted mt-3">ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚</p>
            <a href="../index.html" class="btn btn-primary mt-3">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>

        </div>

        <!-- æœªãƒ­ã‚°ã‚¤ãƒ³ -->
        <div id="login-prompt" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">ğŸ”</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h2>
            <p class="text-muted mt-3">ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
            <button onclick="loginWithDiscord()" class="btn btn-primary mt-3">
                <img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0a69f118df70ad7828d4_icon_clyde_blurple_RGB.svg"
                    alt="Discord" style="width: 20px; margin-right: 8px;">
                Discordã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>
        </div>

        <!-- ç®¡ç†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="admin-content" class="row justify-content-center" style="display: none;">
            <div class="col-12 col-lg-12">
                <div class="content-card">
                    <div class="mb-4">
                        <ul class="nav nav-pills" id="adminTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="records-tab" data-bs-toggle="pill"
                                    data-bs-target="#records-pane" type="button" role="tab">ğŸ† å¤§ä¼šè¨˜éŒ²ç®¡ç†</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="users-tab" data-bs-toggle="pill"
                                    data-bs-target="#users-pane" type="button" role="tab" onclick="fetchUsers()">ğŸ‘¥
                                    ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="team-requests-tab" data-bs-toggle="pill"
                                    data-bs-target="#team-requests-pane" type="button" role="tab"
                                    onclick="fetchTeamRequests()">ğŸ…
                                    ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹ <span id="team-requests-badge" class="badge bg-danger"
                                        style="display: none;">0</span></button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="badges-tab" data-bs-toggle="pill"
                                    data-bs-target="#badges-pane" type="button" role="tab" onclick="fetchBadges()">ğŸ“›
                                    ãƒãƒƒã‚¸ç®¡ç†</button>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content" id="adminTabContent">
                        <!-- è¨˜éŒ²ç®¡ç†ã‚¿ãƒ– -->
                        <div class="tab-pane fade show active" id="records-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ†
                                    å¤§ä¼šè¨˜éŒ²ç®¡ç†</h2>
                                <div class="csv-actions">
                                    <button onclick="document.getElementById('csv-import-input').click()"
                                        class="btn btn-outline-primary btn-sm">
                                        ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                                    </button>
                                    <input type="file" id="csv-import-input" style="display: none;" accept=".csv"
                                        onchange="handleCSVImport(event)">
                                    <button onclick="exportToCSV()" class="btn btn-outline-secondary btn-sm">
                                        ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                    </button>
                                </div>
                            </div>

                            <!-- å¤§ä¼šè¨˜éŒ²ä¸€è¦§ -->
                            <div class="admin-section">
                                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">ğŸ“‹ æœ€è¿‘ã®è¨˜éŒ²</h5>
                                    <div class="d-flex gap-2 mt-2 mt-md-0">
                                        <button onclick="toggleFilterPanel()" class="btn btn-outline-primary btn-sm">ğŸ”
                                            ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</button>
                                        <button onclick="openRecordModal()"
                                            class="btn btn-primary btn-sm">è¨˜éŒ²ã‚’è¿½åŠ </button>
                                    </div>
                                </div>

                                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ãƒãƒ« -->
                                <div id="filter-panel" class="filter-panel shadow-sm">
                                    <div class="row">
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</div>
                                            <div id="filter-accounts" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸ† å¤§ä¼šå</div>
                                            <div id="filter-tournaments" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸš© ãƒãƒ¼ãƒ å</div>
                                            <div id="filter-teams" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">ğŸ€„ ãƒ¢ãƒ¼ãƒ‰</div>
                                            <div id="filter-modes" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">âš”ï¸ è©¦åˆæ–¹æ³•</div>
                                            <div id="filter-match-modes" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>

                                    </div>
                                    <div class="d-flex justify-content-end gap-2 mt-2">
                                        <button onclick="clearFilters()"
                                            class="btn btn-link btn-sm text-muted text-decoration-none">ãƒªã‚»ãƒƒãƒˆ</button>
                                        <button onclick="toggleFilterPanel()"
                                            class="btn btn-secondary btn-sm">é–‰ã˜ã‚‹</button>
                                    </div>
                                </div>

                                <div class="table-responsive">

                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th onclick="sortRecords('event_datetime')" class="sortable"
                                                    id="th-event_datetime">æ—¥æ™‚</th>
                                                <th onclick="sortRecords('account_name')" class="sortable"
                                                    id="th-account_name">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</th>
                                                <th onclick="sortRecords('tournament_type')" class="sortable"
                                                    id="th-tournament_type">å¤§ä¼š/ãƒ¢ãƒ¼ãƒ‰</th>
                                                <th onclick="sortRecords('final_score')" class="sortable"
                                                    id="th-final_score">å¾—ç‚¹</th>
                                                <th onclick="sortRecords('rank')" class="sortable" id="th-rank">é †ä½</th>
                                                <th onclick="sortRecords('matches_played')" class="sortable"
                                                    id="th-matches_played">å¯¾å±€æ•°</th>
                                                <th>æ“ä½œ</th>
                                            </tr>
                                        </thead>

                                        <tbody id="records-list-body">
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="text-center mt-4 p-3 rounded" style="background: #f8f9fa;">
                                <p class="mb-0">ğŸ“ ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹: <code>/admin/index.html</code></p>
                            </div>
                        </div>

                        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="users-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ‘¥
                                Discordé€£æºãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ã‚¢ãƒã‚¿ãƒ¼</th>
                                            <th>Discordå / ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
                                            <th>Discord ID</th>
                                            <th>æœ€çµ‚æ›´æ–°</th>
                                            <th>æ‰€æŒé‡‘</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-list-body">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="team-requests-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ…
                                ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹</h2>

                            <!-- è¿½æ”¾ç”³è«‹ -->
                            <div class="admin-section">
                                <h5 class="mb-3">ğŸš« ãƒ¡ãƒ³ãƒãƒ¼è¿½æ”¾ç”³è«‹</h5>
                                <div id="kick-requests-list">
                                    <p class="text-muted">èª­ã¿è¾¼ã¿ä¸­...</p>
                                </div>
                            </div>

                            <!-- è§£æ•£ç”³è«‹ -->
                            <div class="admin-section">
                                <h5 class="mb-3">ğŸ’¥ ãƒãƒ¼ãƒ è§£æ•£ç”³è«‹</h5>
                                <div id="dissolution-requests-list">
                                    <p class="text-muted">èª­ã¿è¾¼ã¿ä¸­...</p>
                                </div>
                            </div>
                        </div>

                        <!-- ãƒãƒƒã‚¸ç®¡ç†ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="badges-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ“›
                                    ãƒãƒƒã‚¸ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†</h2>
                                <div class="d-flex gap-2">
                                    <button onclick="document.getElementById('badge-bulk-upload').click()"
                                        class="btn btn-outline-success btn-sm">
                                        ğŸ–¼ï¸ ç”»åƒä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                                    </button>
                                    <input type="file" id="badge-bulk-upload" style="display: none;" accept="image/*"
                                        multiple onchange="handleBulkBadgeUpload(event)">
                                    <button onclick="exportBadgesToCSV()" class="btn btn-outline-secondary btn-sm">
                                        ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                    </button>
                                    <button onclick="openBadgeModal()" class="btn btn-primary">æ–°è¦ãƒãƒƒã‚¸ç™»éŒ²</button>
                                </div>
                            </div>
                            <div class="row g-3" id="badges-list">
                                <!-- ãƒãƒƒã‚¸ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                                <p class="text-center text-muted py-5">èª­ã¿è¾¼ã¿ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¨˜éŒ²ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="recordModalLabel">å¤§ä¼šè¨˜éŒ²ç·¨é›†</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="record-form">
                                <input type="hidden" id="record-id">

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="event_datetime" class="form-label">æ—¥æ™‚</label>
                                        <input type="datetime-local" class="form-control" id="event_datetime" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="account_name" class="form-label">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</label>
                                        <input type="text" class="form-control" id="account_name" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
                                            required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="tournament_type" class="form-label">å¤§ä¼šå (ç¬¬ä¸€å›ãªã©)</label>
                                        <input type="text" class="form-control" id="tournament_type">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="team_name" class="form-label">ãƒãƒ¼ãƒ å</label>
                                        <input type="text" class="form-control" id="team_name">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="mahjong_mode" class="form-label">éº»é›€/ãƒ¢ãƒ¼ãƒ‰ (å››éº»/ä¸‰éº»)</label>
                                        <input type="text" class="form-control" id="mahjong_mode">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="match_mode" class="form-label">è©¦åˆæ–¹å¼ (ãƒãƒ¼ãƒ /å€‹äºº)</label>
                                        <input type="text" class="form-control" id="match_mode">
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="final_score" class="form-label">æœ€çµ‚å¾—ç‚¹</label>
                                        <input type="number" step="0.1" class="form-control" id="final_score" required>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="rank" class="form-label">é †ä½</label>
                                        <input type="number" class="form-control" id="rank" min="1" max="4">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="matches_played" class="form-label">å¯¾å±€æ•°</label>
                                        <input type="number" class="form-control" id="matches_played" value="1">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="win_count" class="form-label">å’Œäº†æ•°</label>
                                        <input type="number" class="form-control" id="win_count" value="0">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="deal_in_count" class="form-label">æ”¾éŠƒæ•°</label>
                                        <input type="number" class="form-control" id="deal_in_count" value="0">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="discord_user_id" class="form-label">Discord User ID (ä»»æ„)</label>
                                        <input type="text" class="form-control" id="discord_user_id">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            <button type="button" class="btn btn-primary" onclick="saveRecordFromForm()">ä¿å­˜ã™ã‚‹</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒãƒƒã‚¸ç™»éŒ²ãƒ»ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div class="modal fade" id="badgeModal" tabindex="-1" aria-labelledby="badgeModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="badgeModalLabel">ãƒãƒƒã‚¸ç™»éŒ²ãƒ»ç·¨é›†</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="badge-form">
                                <input type="hidden" id="badge-id">
                                <div class="mb-3">
                                    <label for="badge-name" class="form-label">ãƒãƒƒã‚¸å</label>
                                    <input type="text" class="form-control" id="badge-name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="badge-description" class="form-label">èª¬æ˜æ–‡</label>
                                    <textarea class="form-control" id="badge-description" rows="2"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="badge-image-file" class="form-label">ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                                    <input type="file" class="form-control" id="badge-image-file" accept="image/*">
                                    <div id="badge-image-preview" class="mt-2 text-center" style="display: none;">
                                        <img src="" style="max-height: 100px; border-radius: 8px;" class="shadow-sm">
                                    </div>
                                    <input type="hidden" id="badge-image-url">
                                </div>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <label for="badge-weight" class="form-label">ã‚¬ãƒãƒ£é‡ã¿ (ç¢ºç‡ç”¨)</label>
                                        <input type="number" class="form-control" id="badge-weight" value="10">
                                    </div>
                                    <div class="col-6 mb-3">
                                        <label for="badge-price" class="form-label">é‡‘é¡ (ã‚³ã‚¤ãƒ³)</label>
                                        <input type="number" class="form-control" id="badge-price" value="0">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            <button type="button" class="btn btn-primary" onclick="saveBadge()">ä¿å­˜ã™ã‚‹</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ã‚³ã‚¤ãƒ³ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div class="modal fade" id="coinModal" tabindex="-1" aria-labelledby="coinModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="coinModalLabel">ã‚³ã‚¤ãƒ³ç·¨é›†</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-3">
                                <strong id="coin-edit-user-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong>
                            </div>
                            <input type="hidden" id="coin-edit-user-id">
                            <div class="mb-3">
                                <label for="coin-amount" class="form-label">æ‰€æŒã‚³ã‚¤ãƒ³</label>
                                <input type="number" class="form-control text-center fs-4" id="coin-amount" value="0">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary w-100" onclick="saveUserCoins()">ä¿å­˜</button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ãƒãƒƒã‚¸ä»˜ä¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
            <div class="modal fade" id="badgeGrantModal" tabindex="-1" aria-labelledby="badgeGrantModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="badgeGrantModalLabel">ãƒãƒƒã‚¸ä»˜ä¸</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="text-center mb-3">
                                <strong id="badge-grant-user-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong>
                            </div>
                            <input type="hidden" id="badge-grant-user-id">
                            <div class="mb-3">
                                <label class="form-label">ä»˜ä¸ã™ã‚‹ãƒãƒƒã‚¸ã‚’é¸æŠ</label>
                                <div id="badge-grant-list" class="row g-2" style="max-height: 300px; overflow-y: auto;">
                                    <!-- JSã§ç”Ÿæˆ -->
                                </div>
                            </div>
                            <div id="badge-grant-owned" class="mt-3">
                                <label class="form-label text-muted small">ç¾åœ¨æ‰€æŒã—ã¦ã„ã‚‹ãƒãƒƒã‚¸</label>
                                <div id="badge-grant-owned-list" class="d-flex flex-wrap gap-1">
                                    <!-- JSã§ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
            <div id="loading-overlay" class="loading-overlay">
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>


            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <!-- Supabase -->
            <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
            <!-- Supabaseè¨­å®š -->
            <script src="../js/supabase-config.js"></script>
            <script src="../js/auth-guard.js"></script>
            <!-- ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ -->
            <script src="../js/admin.js"></script>


            <script>
                // admin/index.html å†…ã® ADMIN_DISCORD_IDS å®šç¾©ã¯å‰Šé™¤ (supabase-config.js ã‚’ä½¿ç”¨)


                // ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯
                async function checkAdminAccess() {
                    const loading = document.getElementById('loading');
                    const accessDenied = document.getElementById('access-denied');
                    const loginPrompt = document.getElementById('login-prompt');
                    const adminContent = document.getElementById('admin-content');

                    const user = await getCurrentUser();

                    if (!user) {
                        // æœªãƒ­ã‚°ã‚¤ãƒ³
                        loading.style.display = 'none';
                        loginPrompt.style.display = 'block';
                        return;
                    }

                    const discordId = user.user_metadata.provider_id;
                    console.log('Discord ID:', discordId); // ãƒ‡ãƒãƒƒã‚°ç”¨

                    // ç®¡ç†è€…ãƒªã‚¹ãƒˆãŒç©ºã®å ´åˆã¯å…¨å“¡ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆåˆæœŸè¨­å®šç”¨ï¼‰
                    if (ADMIN_DISCORD_IDS.length === 0 || ADMIN_DISCORD_IDS.includes(discordId)) {
                        loading.style.display = 'none';
                        adminContent.style.display = 'flex';
                    } else {
                        loading.style.display = 'none';
                        accessDenied.style.display = 'block';
                    }
                }

                document.addEventListener('DOMContentLoaded', checkAdminAccess);
            </script>
        </div> <!-- admin-content -->
    </div> <!-- container -->
    <!-- ãƒãƒ¼ãƒ é€šçŸ¥ãƒãƒƒã‚¸ -->
    <script>
        async function checkTeamNotifications() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) return;

            const discordId = user.user_metadata.provider_id;

            const { data: myTeams } = await supabaseClient
                .from('teams')
                .select('id')
                .eq('creator_discord_id', discordId);

            if (!myTeams || myTeams.length === 0) return;

            const teamIds = myTeams.map(t => t.id);

            const { data: pendingRequests } = await supabaseClient
                .from('team_join_requests')
                .select('id')
                .in('team_id', teamIds)
                .in('status', ['pending', 'leave_pending']);

            const count = pendingRequests?.length || 0;

            if (count > 0) {
                const badge = document.getElementById('team-notification-badge');
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = 'inline';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkTeamNotifications);
    </script>
</body>

</html>