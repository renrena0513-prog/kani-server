<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã‹ã«ã‚µãƒ¼ãƒãƒ¼ - ç®¡ç†ç”»é¢">
    <title>ç®¡ç†ç”»é¢ | ã‹ã«ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Bootswatch Lux (Bootstrap 5.3.3) -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --primary-gray: #3a3a4a;
            --deep-gray: #252530;
            --cream: #faf5e8;
            --gold: #d4a853;
            --font-title: 'Noto Serif JP', serif;
            --font-body: 'M PLUS Rounded 1c', sans-serif;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(180deg, #3a3a4a 0%, #2d2d3a 50%, #252530 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .page-header {
            font-family: var(--font-title);
            color: var(--cream);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .back-button {
            font-family: var(--font-body);
            font-size: 1rem;
            padding: 10px 25px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #fff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .admin-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--gold);
        }

        .event-list-item {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .event-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .event-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            background: #f0f0f0;
        }

        .csv-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        th.sortable {
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: background 0.2s;
        }

        th.sortable:hover {
            background-color: #f0f0f0 !important;
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: 8px;
            color: #ccc;
            font-size: 0.8em;
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--gold);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--gold);
        }


        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            visibility: hidden;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .filter-panel {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
            /* åˆæœŸã¯éè¡¨ç¤º */
        }

        .filter-group-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--primary-gray);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .filter-options-scroll {
            max-height: 120px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px;
        }

        .filter-checkbox-label {
            font-size: 0.8rem;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .filter-checkbox-label:hover {
            background: #e0e0e0;
        }

        input[type="checkbox"]:checked+.filter-checkbox-label {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ */
        .nav-dropdown {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .record-button {
            background: linear-gradient(135deg, var(--gold) 0%, #b8892d 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.5);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            cursor: pointer;
        }

        .record-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 168, 83, 0.6);
            color: white;
        }

        .nav-dropdown-menu {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            min-width: 200px;
            overflow: hidden;
        }

        .nav-dropdown-menu .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            transition: background 0.2s;
        }

        .nav-dropdown-menu .dropdown-item:hover {
            background: #f5f5f5;
        }

        .nav-dropdown-menu .dropdown-divider {
            margin: 0;
        }

        .notification-badge {
            background: #dc3545;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }
    </style>

</head>

<body>
    <!-- å³ä¸Šã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
    <div class="nav-dropdown dropdown">
        <button class="record-button dropdown-toggle" type="button" id="navDropdown" data-bs-toggle="dropdown"
            aria-expanded="false">
            ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        </button>
        <ul class="dropdown-menu nav-dropdown-menu dropdown-menu-end" aria-labelledby="navDropdown">
            <li><a class="dropdown-item" href="../index.html">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a></li>
            <li><a class="dropdown-item" href="../mypage/index.html">ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="../mahjong/index.html">ğŸ“Š ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a></li>
            <li><a class="dropdown-item" href="../mahjong/record.html">ğŸ“ è¨˜éŒ²ã™ã‚‹</a></li>
            <li><a class="dropdown-item" href="../mahjong/users/index.html">ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</a></li>
            <li><a class="dropdown-item" href="../mahjong/team/index.html">ğŸ… ãƒãƒ¼ãƒ ç®¡ç† <span id="team-notification-badge"
                        class="notification-badge" style="display:none;">0</span></a></li>
            <li><a class="dropdown-item" href="../badge/list.html">ğŸ“› ãƒãƒƒã‚¸ä¸€è¦§</a></li>
            <li><a class="dropdown-item" href="../badge/shop.html">ğŸ›’ ãƒãƒƒã‚¸ã‚·ãƒ§ãƒƒãƒ—</a></li>
            <li><a class="dropdown-item" href="../ranking/index.html">ğŸ’° è³‡ç”£ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a></li>
            <li class="admin-only" style="display:none;"><a class="dropdown-item" href="../omikuji/index.html">ğŸ‹
                    ãŠã¿ãã˜</a></li>
            <li class="admin-only" style="display:none;">
                <hr class="dropdown-divider">
            </li>
            <li class="admin-only" style="display:none;">
                <a class="dropdown-item" href="./index.html">âš™ï¸ ç®¡ç†ç”»é¢</a>
            </li>
        </ul>
    </div>

    <div class="container py-5">
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="mb-4">
            <a href="../index.html" class="back-button">
                â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </a>
        </div>


        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="text-center mb-5">
            <h1 class="page-header display-4 fw-bold mb-3">âš™ï¸ ç®¡ç†ç”»é¢</h1>
        </header>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div id="loading" class="loading">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">èªè¨¼ã‚’ç¢ºèªä¸­...</p>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ -->
        <div id="access-denied" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">ğŸš«</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“</h2>
            <p class="text-muted mt-3">ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚</p>
            <a href="../index.html" class="btn btn-primary mt-3">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>

        </div>

        <!-- æœªãƒ­ã‚°ã‚¤ãƒ³ -->
        <div id="login-prompt" class="content-card access-denied" style="display: none;">
            <div class="access-denied-icon">ğŸ”</div>
            <h2 style="font-family: var(--font-title); color: var(--deep-gray);">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h2>
            <p class="text-muted mt-3">ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
            <button onclick="loginWithDiscord()" class="btn btn-primary mt-3">
                <img src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0a69f118df70ad7828d4_icon_clyde_blurple_RGB.svg"
                    alt="Discord" style="width: 20px; margin-right: 8px;">
                Discordã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>
        </div>

        <!-- ç®¡ç†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="admin-content" class="row justify-content-center" style="display: none;">
            <div class="col-12 col-lg-12">
                <div class="content-card">
                    <div class="mb-4">
                        <ul class="nav nav-pills" id="adminTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="logs-tab" data-bs-toggle="pill"
                                    data-bs-target="#logs-pane" type="button" role="tab"
                                    onclick="fetchActivityLogs()">ğŸ“
                                    æ´»å‹•ãƒ­ã‚°</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="users-tab" data-bs-toggle="pill"
                                    data-bs-target="#users-pane" type="button" role="tab" onclick="fetchUsers()">ğŸ‘¥
                                    ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="badges-tab" data-bs-toggle="pill"
                                    data-bs-target="#badges-pane" type="button" role="tab" onclick="fetchBadges()">ğŸ“›
                                    ãƒãƒƒã‚¸ç®¡ç†</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="records-tab" data-bs-toggle="pill"
                                    data-bs-target="#records-pane" type="button" role="tab">ğŸ† å¤§ä¼šè¨˜éŒ²ç®¡ç†</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="team-requests-tab" data-bs-toggle="pill"
                                    data-bs-target="#team-requests-pane" type="button" role="tab"
                                    onclick="fetchTeamRequests()">ğŸ…
                                    ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹ <span id="team-requests-badge" class="badge bg-danger"
                                        style="display: none;">0</span></button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pages-tab" data-bs-toggle="pill"
                                    data-bs-target="#pages-pane" type="button" role="tab"
                                    onclick="fetchPageSettings()">ğŸš§
                                    ãƒšãƒ¼ã‚¸ç®¡ç†</button>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content" id="adminTabContent">
                        <!-- è¨˜éŒ²ç®¡ç†ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="records-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ†
                                    å¤§ä¼šè¨˜éŒ²ç®¡ç†</h2>
                                <div class="csv-actions">
                                    <button onclick="document.getElementById('csv-import-input').click()"
                                        class="btn btn-outline-primary btn-sm">
                                        ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                                    </button>
                                    <input type="file" id="csv-import-input" style="display: none;" accept=".csv"
                                        onchange="handleCSVImport(event)">
                                    <button onclick="exportToCSV()" class="btn btn-outline-secondary btn-sm">
                                        ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                    </button>
                                </div>
                            </div>

                            <!-- å¤§ä¼šè¨˜éŒ²ä¸€è¦§ -->
                            <div class="admin-section">
                                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">ğŸ“‹ æœ€è¿‘ã®è¨˜éŒ²</h5>
                                    <div class="d-flex gap-2 mt-2 mt-md-0">
                                        <button onclick="toggleFilterPanel()" class="btn btn-outline-primary btn-sm">ğŸ”
                                            ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</button>
                                        <button onclick="openRecordModal()"
                                            class="btn btn-primary btn-sm">è¨˜éŒ²ã‚’è¿½åŠ </button>
                                    </div>
                                </div>

                                <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ãƒãƒ« -->
                                <div id="filter-panel" class="filter-panel shadow-sm">
                                    <div class="row">
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</div>
                                            <div class="px-1 mb-2">
                                                <input type="text" id="filter-account-search"
                                                    class="form-control form-control-sm" placeholder="åå‰ã§æ¤œç´¢..."
                                                    oninput="searchFilterAccounts()">
                                            </div>
                                            <div id="filter-accounts" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸ† å¤§ä¼šå</div>
                                            <div id="filter-tournaments" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-2 mb-3">
                                            <div class="filter-group-title">ğŸš© ãƒãƒ¼ãƒ å</div>
                                            <div id="filter-teams" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">ğŸ€„ ãƒ¢ãƒ¼ãƒ‰</div>
                                            <div id="filter-modes" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-4 col-lg-3 mb-3">
                                            <div class="filter-group-title">âš”ï¸ è©¦åˆæ–¹æ³•</div>
                                            <div id="filter-match-modes" class="filter-options-scroll">
                                                <!-- å‹•çš„ã«ç”Ÿæˆ -->
                                            </div>
                                        </div>

                                    </div>
                                    <div class="d-flex justify-content-end gap-2 mt-2">
                                        <button onclick="clearFilters()"
                                            class="btn btn-link btn-sm text-muted text-decoration-none">ãƒªã‚»ãƒƒãƒˆ</button>
                                        <button onclick="toggleFilterPanel()"
                                            class="btn btn-secondary btn-sm">é–‰ã˜ã‚‹</button>
                                    </div>
                                </div>

                                <div class="table-responsive">

                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th onclick="sortRecords('event_datetime')" class="sortable"
                                                    id="th-event_datetime">æ—¥æ™‚</th>
                                                <th onclick="sortRecords('account_name')" class="sortable"
                                                    id="th-account_name">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</th>
                                                <th onclick="sortRecords('tournament_type')" class="sortable"
                                                    id="th-tournament_type">å¤§ä¼š/ãƒ¢ãƒ¼ãƒ‰</th>
                                                <th onclick="sortRecords('final_score')" class="sortable"
                                                    id="th-final_score">å¾—ç‚¹</th>
                                                <th onclick="sortRecords('rank')" class="sortable" id="th-rank">é †ä½</th>
                                                <th onclick="sortRecords('matches_played')" class="sortable"
                                                    id="th-matches_played">å¯¾å±€æ•°</th>
                                                <th>æ“ä½œ</th>
                                            </tr>
                                        </thead>

                                        <tbody id="records-list-body">
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="text-center mt-4 p-3 rounded" style="background: #f8f9fa;">
                                <p class="mb-0">ğŸ“ ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹: <code>/admin/index.html</code></p>
                            </div>
                        </div>

                        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="users-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ‘¥
                                Discordé€£æºãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ã‚¢ãƒã‚¿ãƒ¼</th>
                                            <th>Discordå / ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
                                            <th>Discord ID</th>
                                            <th>æœ€çµ‚æ›´æ–°</th>
                                            <th>æ‰€æŒé‡‘</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-list-body">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="team-requests-pane" role="tabpanel" tabindex="0">
                            <h2 class="mb-4" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ…
                                ãƒãƒ¼ãƒ ç®¡ç†ç”³è«‹</h2>

                            <!-- è¿½æ”¾ç”³è«‹ -->
                            <div class="admin-section">
                                <h5 class="mb-3">ğŸš« ãƒ¡ãƒ³ãƒãƒ¼è¿½æ”¾ç”³è«‹</h5>
                                <div id="kick-requests-list">
                                    <p class="text-muted">èª­ã¿è¾¼ã¿ä¸­...</p>
                                </div>
                            </div>

                            <!-- è§£æ•£ç”³è«‹ -->
                            <div class="admin-section">
                                <h5 class="mb-3">ğŸ’¥ ãƒãƒ¼ãƒ è§£æ•£ç”³è«‹</h5>
                                <div id="dissolution-requests-list">
                                    <p class="text-muted">èª­ã¿è¾¼ã¿ä¸­...</p>
                                </div>
                            </div>
                        </div>

                        <!-- ãƒãƒƒã‚¸ç®¡ç†ã‚¿ãƒ– -->
                        <div class="tab-pane fade" id="badges-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ“›
                                    ãƒãƒƒã‚¸ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†</h2>
                                <div class="d-flex gap-2">
                                    <button onclick="document.getElementById('badge-bulk-upload').click()"
                                        class="btn btn-outline-success btn-sm">
                                        ğŸ–¼ï¸ ç”»åƒä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                                    </button>
                                    <input type="file" id="badge-bulk-upload" style="display: none;" accept="image/*"
                                        multiple onchange="handleBulkBadgeUpload(event)">
                                    <button onclick="document.getElementById('badge-csv-import').click()"
                                        class="btn btn-outline-primary btn-sm">
                                        ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                                    </button>
                                    <input type="file" id="badge-csv-import" style="display: none;" accept=".csv"
                                        onchange="handleBadgeCSVImport(event)">
                                    <button onclick="exportBadgesToCSV()" class="btn btn-outline-secondary btn-sm">
                                        ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                                    </button>
                                    <button onclick="openBadgeModal()" class="btn btn-primary">æ–°è¦ãƒãƒƒã‚¸ç™»éŒ²</button>
                                </div>
                            </div>
                            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¿ãƒ– -->
                            <div class="mb-3">
                                <div class="d-flex flex-wrap gap-2" id="admin-badge-filter-tabs">
                                    <button class="btn btn-sm btn-outline-secondary active"
                                        onclick="setAdminBadgeFilter('all', this)">å…¨ä»¶</button>
                                    <button class="btn btn-sm btn-outline-secondary"
                                        onclick="setAdminBadgeFilter('shop', this)">ã‚·ãƒ§ãƒƒãƒ—è²©å£²ä¸­</button>
                                    <button class="btn btn-sm btn-outline-secondary"
                                        onclick="setAdminBadgeFilter('gacha', this)">ã‚¬ãƒãƒ£æ’å‡ºãƒãƒƒã‚¸</button>
                                    <button class="btn btn-sm btn-outline-secondary"
                                        onclick="setAdminBadgeFilter('exchange', this)">æ›é‡‘ã‚¢ã‚¤ãƒ†ãƒ </button>
                                    <button class="btn btn-sm btn-outline-secondary"
                                        onclick="setAdminBadgeFilter('limited', this)">é™å®šå“</button>
                                    <button class="btn btn-sm btn-outline-secondary"
                                        onclick="setAdminBadgeFilter('not_for_sale', this)">éå£²å“</button>
                                </div>
                                <div class="d-flex flex-wrap gap-3 align-items-center mt-2">
                                    <div class="d-flex align-items-center gap-2">
                                        <label class="small text-muted mb-0">ä¸¦ã³æ›¿ãˆ</label>
                                        <select id="admin-badge-sort" class="form-select form-select-sm" style="width: auto;">
                                            <option value="sort_order_asc">è¡¨ç¤ºé †ï¼ˆå°â†’å¤§ï¼‰</option>
                                            <option value="sort_order_desc">è¡¨ç¤ºé †ï¼ˆå¤§â†’å°ï¼‰</option>
                                            <option value="id_desc">ãƒãƒƒã‚¸IDï¼ˆé«˜â†’ä½ï¼‰</option>
                                            <option value="id_asc">ãƒãƒƒã‚¸IDï¼ˆä½â†’é«˜ï¼‰</option>
                                            <option value="price_asc">ä¾¡æ ¼ï¼ˆä½â†’é«˜ï¼‰</option>
                                            <option value="price_desc">ä¾¡æ ¼ï¼ˆé«˜â†’ä½ï¼‰</option>
                                            <option value="name_asc">åå‰ï¼ˆæ˜‡é †ï¼‰</option>
                                        </select>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <label class="small text-muted mb-0">ã‚¿ã‚¤ãƒ—</label>
                                        <select id="admin-badge-type" class="form-select form-select-sm" style="width: auto;">
                                            <option value="all">å…¨ã‚¿ã‚¤ãƒ—</option>
                                            <option value="å¤‰å‹•å‹">å¤‰å‹•å‹</option>
                                            <option value="å›ºå®šå‹">å›ºå®šå‹</option>
                                            <option value="é™å®šå“">é™å®šå“</option>
                                            <option value="æ›é‡‘å“">æ›é‡‘å“</option>
                                            <option value="none">æœªè¨­å®š</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-3" id="badges-list">
                                <!-- ãƒãƒƒã‚¸ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                                <p class="text-center text-muted py-5">èª­ã¿è¾¼ã¿ä¸­...</p>
                            </div>
                            <div class="d-flex justify-content-center align-items-center gap-3 mt-4" id="badges-pagination-area" style="display:none;">
                                <button id="prev-badges-btn" class="btn btn-outline-secondary btn-sm" onclick="changeBadgesPage(-1)" disabled>â—€ å‰ã¸</button>
                                <span id="badges-page-info" class="fw-bold">1 / -</span>
                                <button id="next-badges-btn" class="btn btn-outline-secondary btn-sm" onclick="changeBadgesPage(1)">æ¬¡ã¸ â–¶</button>
                            </div>
                        </div>

                        <!-- æ´»å‹•ãƒ­ã‚°ã‚¿ãƒ– -->
                        <div class="tab-pane fade show active" id="logs-pane" role="tabpanel" tabindex="0">
                            <div class="d-flex justify-content-between align-items-center mb-4 gap-3 flex-wrap">
                                <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸ“
                                    å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ãƒ­ã‚°</h2>
                                <div class="d-flex gap-2">
                                    <select id="log-action-filter" class="form-select form-select-sm"
                                        style="width: auto;" onchange="handleLogActionFilterChange()">
                                        <option value="all">ğŸ” ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</option>
                                        <option value="gacha_draw">ğŸ° ã‚¬ãƒãƒ£</option>
                                        <option value="coin_transfer">ğŸ’¸ ã‚³ã‚¤ãƒ³é€é‡‘ãƒ»å—å–</option>
                                        <option value="badge_purchase">ğŸ›’ ãƒãƒƒã‚¸è³¼å…¥ãƒ»å£²å´</option>
                                        <option value="badge_transfer">ğŸ ãƒãƒƒã‚¸è­²æ¸¡ãƒ»å—å–</option>
                                        <option value="omikuji">â›©ï¸ ãŠã¿ãã˜</option>
                                        <option value="admin_edit">ğŸ”§ ç®¡ç†è€…èª¿æ•´</option>
                                    </select>
                                    <button onclick="fetchActivityLogs()" class="btn btn-outline-primary btn-sm">ğŸ”„
                                        æ›´æ–°</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle" style="font-size: 0.9rem;">
                                    <thead class="table-light">
                                        <tr>
                                            <th>æ—¥æ™‚</th>
                                            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                                            <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                                            <th>å†…å®¹ / å¯¾è±¡</th>
                                            <th>é‡‘é¡</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="logs-list-body">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                            <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
                                <button id="prev-logs-btn" onclick="changeLogsPage(-1)"
                                    class="btn btn-outline-secondary btn-sm" disabled>â—€ å‰ã¸</button>
                                <span id="logs-page-info" class="fw-bold">1 / -</span>
                                <button id="next-logs-btn" onclick="changeLogsPage(1)"
                                    class="btn btn-outline-secondary btn-sm">æ¬¡ã¸ â–¶</button>
                            </div>
                        </div>
                    </div>

                    <!-- ãƒšãƒ¼ã‚¸ç®¡ç†ã‚¿ãƒ– -->
                    <div class="tab-pane fade" id="pages-pane" role="tabpanel" tabindex="0">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2 class="mb-0" style="font-family: var(--font-title); color: var(--deep-gray);">ğŸš§
                                ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†</h2>
                            <button onclick="fetchPageSettings()" class="btn btn-outline-primary btn-sm">ğŸ”„ æ›´æ–°</button>
                        </div>

                        <div class="alert alert-info border-0 shadow-sm">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <strong>æ©Ÿèƒ½èª¬æ˜:</strong> ã“ã“ã§å„æ©Ÿèƒ½ã‚’ã€ŒOFFã€ã«ã™ã‚‹ã¨ã€ç®¡ç†è€…ä»¥å¤–ã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è©²å½“ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã™ï¼ˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰ã€‚
                            <br>ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚„æ©Ÿèƒ½ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæº–å‚™æ™‚ã«ã”æ´»ç”¨ãã ã•ã„ã€‚
                        </div>

                        <div class="table-responsive bg-white rounded shadow-sm border">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>æ©Ÿèƒ½å / ãƒ‘ã‚¹</th>
                                        <th>çŠ¶æ…‹</th>
                                        <th>æœ€çµ‚æ›´æ–°</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="pages-list-body">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted py-4">èª­ã¿è¾¼ã¿ä¸­...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨˜éŒ²ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="recordModalLabel">å¤§ä¼šè¨˜éŒ²ç·¨é›†</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="record-form">
                            <input type="hidden" id="match-id">

                            <!-- å…±é€šé …ç›® -->
                            <div class="admin-section mb-4" style="border-left-color: #007bff;">
                                <h6 class="mb-3 text-primary fw-bold">å…±é€šé …ç›®</h6>
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <label for="event_datetime" class="form-label">æ—¥æ™‚</label>
                                        <input type="datetime-local" class="form-control" id="event_datetime" required>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="tournament_type" class="form-label">å¤§ä¼šå</label>
                                        <input type="text" class="form-control" id="tournament_type">
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="mahjong_mode" class="form-label">éº»é›€/ãƒ¢ãƒ¼ãƒ‰</label>
                                        <select class="form-select" id="mahjong_mode">
                                            <option value="å››éº»">å››éº»</option>
                                            <option value="ä¸‰éº»">ä¸‰éº»</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="match_mode" class="form-label">è©¦åˆæ–¹å¼</label>
                                        <input type="text" class="form-control" id="match_mode" placeholder="å€‹äººæˆ¦">
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <label for="hand_count" class="form-label">å±€æ•°</label>
                                        <input type="number" class="form-control" id="hand_count">
                                    </div>

                                    <!-- ãƒ«ãƒ¼ãƒ«è©³ç´°è¨­å®š -->
                                    <div class="col-6 col-md-3 mb-3">
                                        <label for="dist_points" class="form-label">é…çµ¦ç‚¹ (åˆæœŸç‚¹)</label>
                                        <input type="number" class="form-control" id="dist_points" value="25000"
                                            step="500">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label class="form-label">é£›ã³è³è¨­å®š</label>
                                        <div class="form-check form-switch mt-1">
                                            <input class="form-check-input" type="checkbox" id="opt_tobi">
                                            <label class="form-check-label" for="opt_tobi">æœ‰åŠ¹ (ã‚¢ãƒª)</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label class="form-label">ã‚„ãã¨ã‚Šè¨­å®š</label>
                                        <div class="form-check form-switch mt-1">
                                            <input class="form-check-input" type="checkbox" id="opt_yakitori">
                                            <label class="form-check-label" for="opt_yakitori">æœ‰åŠ¹ (ã‚¢ãƒª)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥é …ç›® -->
                            <div id="players-edit-container">
                                <div class="row g-3">
                                    <!-- 4äººåˆ†ã®å…¥åŠ›æ¬„ã‚’JSã§ç”Ÿæˆã™ã‚‹ã‹ã€HTMLã§ç›´æ¥æ›¸ã -->
                                    <!-- ä»Šå›ã¯å¯èª­æ€§ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®ãŸã‚ã«HTMLã«4ã¤é…ç½®ã—ã¾ã™ -->
                                    <!-- å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¯ record[0].account_name ã®ã‚ˆã†ã«JSã§æ‰±ã†ãŸã‚ã€ã‚¯ãƒ©ã‚¹ã§è­˜åˆ¥ã—ã¾ã™ -->

                                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 1 -->
                                    <div class="col-md-6">
                                        <div class="card p-3 shadow-sm player-edit-card" data-index="0">
                                            <h6
                                                class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                <span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 1</span>
                                                <span class="badge bg-secondary player-discord-id-display"
                                                    style="font-size: 0.65rem;">ID: -</span>
                                            </h6>
                                            <input type="hidden" class="player-record-id">
                                            <input type="hidden" class="player-discord-id">
                                            <div class="row g-2">
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</label>
                                                    <select class="form-select form-select-sm player-account-name">
                                                        <option value="">é¸æŠ...</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ãƒãƒ¼ãƒ å</label>
                                                    <select class="form-select form-select-sm player-team-name">
                                                        <option value="">(ãªã—)</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted fw-bold text-primary">ç´ ç‚¹
                                                        (æŒã¡ç‚¹)</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-raw-points border-primary"
                                                        placeholder="25000">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">å’Œäº†æ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-win-count">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">æ”¾éŠƒæ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-deal-in-count">
                                                </div>

                                                <!-- è‡ªå‹•è¨ˆç®—ã‚¨ãƒªã‚¢ -->
                                                <div class="col-12 mt-2">
                                                    <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                        style="font-size: 0.85rem;">
                                                        <div>
                                                            <span class="text-muted small">é †ä½:</span>
                                                            <span class="fw-bold fs-6 player-rank-display">-</span>ä½
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">ã‚¹ã‚³ã‚¢:</span>
                                                            <span
                                                                class="fw-bold fs-6 player-final-score-display">-</span>
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">å ±é…¬:</span>
                                                            <span class="fw-bold fs-6 player-reward-preview">-</span>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" class="player-rank">
                                                    <input type="hidden" class="player-final-score">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 2 -->
                                    <div class="col-md-6">
                                        <div class="card p-3 shadow-sm player-edit-card" data-index="1">
                                            <h6
                                                class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                <span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 2</span>
                                                <span class="badge bg-secondary player-discord-id-display"
                                                    style="font-size: 0.65rem;">ID: -</span>
                                            </h6>
                                            <input type="hidden" class="player-record-id">
                                            <input type="hidden" class="player-discord-id">
                                            <div class="row g-2">
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</label>
                                                    <select class="form-select form-select-sm player-account-name">
                                                        <option value="">é¸æŠ...</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ãƒãƒ¼ãƒ å</label>
                                                    <select class="form-select form-select-sm player-team-name">
                                                        <option value="">(ãªã—)</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted fw-bold text-primary">ç´ ç‚¹
                                                        (æŒã¡ç‚¹)</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-raw-points border-primary"
                                                        placeholder="25000">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">å’Œäº†æ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-win-count">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">æ”¾éŠƒæ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-deal-in-count">
                                                </div>

                                                <!-- è‡ªå‹•è¨ˆç®—ã‚¨ãƒªã‚¢ -->
                                                <div class="col-12 mt-2">
                                                    <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                        style="font-size: 0.85rem;">
                                                        <div>
                                                            <span class="text-muted small">é †ä½:</span>
                                                            <span class="fw-bold fs-6 player-rank-display">-</span>ä½
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">ã‚¹ã‚³ã‚¢:</span>
                                                            <span
                                                                class="fw-bold fs-6 player-final-score-display">-</span>
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">å ±é…¬:</span>
                                                            <span class="fw-bold fs-6 player-reward-preview">-</span>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" class="player-rank">
                                                    <input type="hidden" class="player-final-score">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 3 -->
                                    <div class="col-md-6">
                                        <div class="card p-3 shadow-sm player-edit-card" data-index="2">
                                            <h6
                                                class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                <span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 3</span>
                                                <span class="badge bg-secondary player-discord-id-display"
                                                    style="font-size: 0.65rem;">ID: -</span>
                                            </h6>
                                            <input type="hidden" class="player-record-id">
                                            <input type="hidden" class="player-discord-id">
                                            <div class="row g-2">
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</label>
                                                    <select class="form-select form-select-sm player-account-name">
                                                        <option value="">é¸æŠ...</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ãƒãƒ¼ãƒ å</label>
                                                    <select class="form-select form-select-sm player-team-name">
                                                        <option value="">(ãªã—)</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted fw-bold text-primary">ç´ ç‚¹
                                                        (æŒã¡ç‚¹)</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-raw-points border-primary"
                                                        placeholder="25000">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">å’Œäº†æ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-win-count">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">æ”¾éŠƒæ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-deal-in-count">
                                                </div>

                                                <!-- è‡ªå‹•è¨ˆç®—ã‚¨ãƒªã‚¢ -->
                                                <div class="col-12 mt-2">
                                                    <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                        style="font-size: 0.85rem;">
                                                        <div>
                                                            <span class="text-muted small">é †ä½:</span>
                                                            <span class="fw-bold fs-6 player-rank-display">-</span>ä½
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">ã‚¹ã‚³ã‚¢:</span>
                                                            <span
                                                                class="fw-bold fs-6 player-final-score-display">-</span>
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">å ±é…¬:</span>
                                                            <span class="fw-bold fs-6 player-reward-preview">-</span>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" class="player-rank">
                                                    <input type="hidden" class="player-final-score">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 4 -->
                                    <div class="col-md-6">
                                        <div class="card p-3 shadow-sm player-edit-card" data-index="3">
                                            <h6
                                                class="fw-bold mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                                <span>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ 4</span>
                                                <span class="badge bg-secondary player-discord-id-display"
                                                    style="font-size: 0.65rem;">ID: -</span>
                                            </h6>
                                            <input type="hidden" class="player-record-id">
                                            <input type="hidden" class="player-discord-id">
                                            <div class="row g-2">
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå</label>
                                                    <select class="form-select form-select-sm player-account-name">
                                                        <option value="">é¸æŠ...</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted">ãƒãƒ¼ãƒ å</label>
                                                    <select class="form-select form-select-sm player-team-name">
                                                        <option value="">(ãªã—)</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <label class="small text-muted fw-bold text-primary">ç´ ç‚¹
                                                        (æŒã¡ç‚¹)</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-raw-points border-primary"
                                                        placeholder="25000">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">å’Œäº†æ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-win-count">
                                                </div>
                                                <div class="col-3 mb-2">
                                                    <label class="small text-muted">æ”¾éŠƒæ•°</label>
                                                    <input type="number"
                                                        class="form-control form-control-sm player-deal-in-count">
                                                </div>

                                                <!-- è‡ªå‹•è¨ˆç®—ã‚¨ãƒªã‚¢ -->
                                                <div class="col-12 mt-2">
                                                    <div class="p-2 rounded bg-light border d-flex justify-content-between align-items-center"
                                                        style="font-size: 0.85rem;">
                                                        <div>
                                                            <span class="text-muted small">é †ä½:</span>
                                                            <span class="fw-bold fs-6 player-rank-display">-</span>ä½
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">ã‚¹ã‚³ã‚¢:</span>
                                                            <span
                                                                class="fw-bold fs-6 player-final-score-display">-</span>
                                                        </div>
                                                        <div>
                                                            <span class="text-muted small">å ±é…¬:</span>
                                                            <span class="fw-bold fs-6 player-reward-preview">-</span>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" class="player-rank">
                                                    <input type="hidden" class="player-final-score">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="button" class="btn btn-primary" onclick="saveRecord()">ä¿å­˜ã™ã‚‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒãƒƒã‚¸ç™»éŒ²ãƒ»ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="badgeModal" tabindex="-1" aria-labelledby="badgeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="badgeModalLabel">ãƒãƒƒã‚¸ç™»éŒ²ãƒ»ç·¨é›†</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="badge-form">
                            <input type="hidden" id="badge-id">
                            <div class="mb-3">
                                <label for="badge-name" class="form-label">ãƒãƒƒã‚¸å</label>
                                <input type="text" class="form-control" id="badge-name" required>
                            </div>
                            <div class="mb-3">
                                <label for="badge-description" class="form-label">èª¬æ˜æ–‡</label>
                                <textarea class="form-control" id="badge-description" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="badge-image-file" class="form-label">ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                                <input type="file" class="form-control" id="badge-image-file" accept="image/*">
                                <div id="badge-image-preview" class="mt-2 text-center" style="display: none;">
                                    <img src="" style="max-height: 100px; border-radius: 8px;" class="shadow-sm">
                                </div>
                                <input type="hidden" id="badge-image-url">
                            </div>
                            <div class="row">

                                <div class="col-6 mb-3">
                                    <label for="badge-price" class="form-label">é‡‘é¡ (ã‚³ã‚¤ãƒ³)</label>
                                    <input type="number" class="form-control" id="badge-price" value="0">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="badge-fixed-rarity" class="form-label">ãƒ¬ã‚¢ãƒªãƒ†ã‚£ (å›ºå®šè¡¨ç¤ºå)</label>
                                <input type="text" class="form-control" id="badge-fixed-rarity"
                                    placeholder="ç©ºã«ã™ã‚‹ã¨ä¾¡æ ¼ã§è‡ªå‹•åˆ¤å®š">
                            </div>
                            <div class="mb-3">
                                <label for="badge-requirements" class="form-label">ç²å¾—æ¡ä»¶</label>
                                <textarea class="form-control" id="badge-requirements" rows="2"
                                    placeholder="ä¾‹ï¼šå¤§ä¼šã§å„ªå‹ã™ã‚‹ã€ç­‰"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="badge-sort-order" class="form-label">è¡¨ç¤ºé † (å°ã•ã„é †)</label>
                                <input type="number" class="form-control" id="badge-sort-order" value="0">
                            </div>
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label for="badge-sales-type" class="form-label">è²©å£²ã‚¿ã‚¤ãƒ—</label>
                                    <select class="form-select" id="badge-sales-type">
                                        <option value="">æœªè¨­å®š</option>
                                        <option value="å¤‰å‹•å‹">å¤‰å‹•å‹ï¼ˆæµé€šæ•°ã§ä¾¡æ ¼å¤‰å‹•ï¼‰</option>
                                        <option value="å›ºå®šå‹">å›ºå®šå‹ï¼ˆä¾¡æ ¼å›ºå®šï¼‰</option>
                                        <option value="é™å®šå“">é™å®šå“ï¼ˆå£²å´ä¸å¯ï¼‰</option>
                                        <option value="æ›é‡‘å“">æ›é‡‘å“ï¼ˆå¾¡ç¥çŸ³ç­‰ï¼‰</option>
                                    </select>
                                </div>
                                <div class="col-6 mb-3">
                                    <label for="badge-gacha-eligible" class="form-label">ã‚¬ãƒãƒ£å¯¾è±¡</label>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="badge-gacha-eligible">
                                        <label class="form-check-label" for="badge-gacha-eligible">
                                            ã‚¬ãƒãƒ£ã‹ã‚‰æ’å‡ºã™ã‚‹
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <label for="badge-shop-listed" class="form-label">ã‚·ãƒ§ãƒƒãƒ—æ²è¼‰</label>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="badge-shop-listed" checked>
                                        <label class="form-check-label" for="badge-shop-listed">
                                            ã‚·ãƒ§ãƒƒãƒ—ã«è¡¨ç¤ºã™ã‚‹
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">æ¨©åˆ©è€…ï¼ˆå£²ä¸Š10%é‚„å…ƒå…ˆï¼‰</label>
                                <div class="dropdown" id="badge-owner-dropdown">
                                    <button class="btn btn-outline-secondary w-100 text-start d-flex align-items-center gap-2"
                                        type="button" data-bs-toggle="dropdown" aria-expanded="false"
                                        id="badge-owner-btn" data-value="">
                                        <img id="badge-owner-avatar" src="" alt="" style="width: 20px; height: 20px; border-radius: 50%; display:none;">
                                        <span id="badge-owner-label">ãªã—ï¼ˆæ¨©åˆ©è€…ãªã—ï¼‰</span>
                                    </button>
                                    <ul class="dropdown-menu w-100" id="badge-owner-menu"></ul>
                                </div>
                                <input type="hidden" id="badge-owner" value="">
                                <small class="text-muted">é¸æŠã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒãƒƒã‚¸å£²ä¸Šã®10%ãŒé‚„å…ƒã•ã‚Œã¾ã™</small>
                            </div>
                            <div class="mb-3">
                                <label for="badge-label" class="form-label">ãƒ©ãƒ™ãƒ«</label>
                                <input type="text" class="form-control" id="badge-label" maxlength="20" placeholder="ä¾‹: NEW / æ³¨ç›®">
                                <small class="text-muted">ç©ºæ¬„ãªã‚‰è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</small>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="button" class="btn btn-primary" onclick="saveBadge()">ä¿å­˜ã™ã‚‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚³ã‚¤ãƒ³ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="coinModal" tabindex="-1" aria-labelledby="coinModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="coinModalLabel">ã‚³ã‚¤ãƒ³ç·¨é›†</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <strong id="coin-edit-user-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong>
                        </div>
                        <input type="hidden" id="coin-edit-user-id">
                        <div class="mb-3">
                            <label for="coin-amount" class="form-label">æ‰€æŒã‚³ã‚¤ãƒ³</label>
                            <input type="number" class="form-control text-center fs-4" id="coin-amount" value="0">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary w-100" onclick="saveUserCoins()">ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="itemsModal" tabindex="-1" aria-labelledby="itemsModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="itemsModalLabel">æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <strong id="items-edit-user-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong>
                        </div>
                        <input type="hidden" id="items-edit-user-id">
                        <div class="mb-3">
                            <label for="items-gacha" class="form-label">ç¥ˆé¡˜ç¬¦ (gacha_tickets)</label>
                            <input type="number" class="form-control" id="items-gacha" value="0" min="0">
                        </div>
                        <div class="mb-3">
                            <label for="items-mangan" class="form-label">æº€é¡˜ç¬¦ (mangan_tickets)</label>
                            <input type="number" class="form-control" id="items-mangan" value="0" min="0">
                        </div>
                        <div class="mb-2 fw-bold">å¼•æ›åˆ¸ (exchange_tickets)</div>
                        <div id="items-exchange-list" class="vstack gap-2">
                            <div class="text-muted small">èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="button" class="btn btn-primary" onclick="saveUserItems()">ä¿å­˜ã™ã‚‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒãƒƒã‚¸ä»˜ä¸ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="badgeGrantUserModal" tabindex="-1" aria-labelledby="badgeGrantUserModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="badgeGrantUserModalLabel">ä»˜ä¸ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="badge-grant-user-list">
                            <div class="text-center text-muted py-3">èª­ã¿è¾¼ã¿ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- ãƒãƒƒã‚¸ä»˜ä¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal fade" id="badgeGrantModal" tabindex="-1" aria-labelledby="badgeGrantModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="badgeGrantModalLabel">ãƒãƒƒã‚¸ä»˜ä¸</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-3">
                            <strong id="badge-grant-user-name">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong>
                        </div>
                        <input type="hidden" id="badge-grant-user-id">
                        <div class="mb-3">
                            <label class="form-label">ä»˜ä¸ã™ã‚‹ãƒãƒƒã‚¸ã‚’é¸æŠ</label>
                            <div id="badge-grant-list" class="row g-2" style="max-height: 300px; overflow-y: auto;">
                                <!-- JSã§ç”Ÿæˆ -->
                            </div>
                        </div>
                        <div id="badge-grant-owned" class="mt-3">
                            <label class="form-label text-muted small">ç¾åœ¨æ‰€æŒã—ã¦ã„ã‚‹ãƒãƒƒã‚¸</label>
                            <div id="badge-grant-owned-list" class="d-flex flex-wrap gap-1">
                                <!-- JSã§ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button type="button" class="btn btn-primary" onclick="grantMultiBadges()">é¸æŠã—ãŸãƒãƒƒã‚¸ã‚’ä»˜ä¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>


        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Supabase -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <!-- Supabaseè¨­å®š -->
        <script src="../js/supabase-config.js"></script>
        <script src="../js/auth-guard.js"></script>
        <!-- ã€ä¸€æ™‚çš„ã€‘ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ’¤å»æ™‚ã¯ä¸‹1è¡Œã‚’å‰Šé™¤ï¼‰ -->
        <script src="../js/survey-modal.js"></script>
        <script src="../js/navigation.js"></script>
        <!-- ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ -->
        <script src="../js/admin_v2.js?v=20260111_04"></script>
        <script src="../js/admin-pages.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                initAccordionNav('../');
            });
        </script>


        <script>
            // admin/index.html å†…ã® ADMIN_DISCORD_IDS å®šç¾©ã¯å‰Šé™¤ (supabase-config.js ã‚’ä½¿ç”¨)


            // ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯
            async function checkAdminAccess() {
                const loading = document.getElementById('loading');
                const accessDenied = document.getElementById('access-denied');
                const loginPrompt = document.getElementById('login-prompt');
                const adminContent = document.getElementById('admin-content');

                const user = await getCurrentUser();

                if (!user) {
                    // æœªãƒ­ã‚°ã‚¤ãƒ³
                    loading.style.display = 'none';
                    loginPrompt.style.display = 'block';
                    return;
                }

                const discordId = user.user_metadata.provider_id;
                console.log('Discord ID:', discordId); // ãƒ‡ãƒãƒƒã‚°ç”¨

                // ç®¡ç†è€…ãƒªã‚¹ãƒˆãŒç©ºã®å ´åˆã¯å…¨å“¡ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆåˆæœŸè¨­å®šç”¨ï¼‰
                if (ADMIN_DISCORD_IDS.length === 0 || ADMIN_DISCORD_IDS.includes(discordId)) {
                    loading.style.display = 'none';
                    adminContent.style.display = 'flex';
                    // æ´»å‹•ãƒ­ã‚°ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿
                    fetchActivityLogs();
                } else {
                    loading.style.display = 'none';
                    accessDenied.style.display = 'block';
                }
            }

            document.addEventListener('DOMContentLoaded', checkAdminAccess);
        </script>
    </div> <!-- admin-content -->
    </div> <!-- container -->
    <!-- ãƒãƒ¼ãƒ é€šçŸ¥ãƒãƒƒã‚¸ -->
    <script>
        async function checkTeamNotifications() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) return;

            // ãªã‚Šã™ã¾ã—å¯¾å¿œ
            const impersonated = getImpersonatedUser();
            const discordId = impersonated ? impersonated.discord_user_id : user.user_metadata.provider_id;

            const { data: myTeams } = await supabaseClient
                .from('teams')
                .select('id')
                .eq('creator_discord_id', discordId);

            if (!myTeams || myTeams.length === 0) return;

            const teamIds = myTeams.map(t => t.id);

            const { data: pendingRequests } = await supabaseClient
                .from('team_join_requests')
                .select('id')
                .in('team_id', teamIds)
                .in('status', ['pending', 'leave_pending']);

            const count = pendingRequests?.length || 0;

            if (count > 0) {
                const badge = document.getElementById('team-notification-badge');
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = 'inline';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkTeamNotifications);
    </script>
</body>

</html>
